<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-07-09 Sun 13:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs配置文件</title>
<meta name="author" content="Elon Li" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Emacs配置文件
<br />
<span class="subtitle">Fast and modern emacs dotfile</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc234569">1. early-init.el</a></li>
<li><a href="#org888f83b">2. init.el</a>
<ul>
<li><a href="#orgb2dcb75">2.1. init.el 文件头</a></li>
<li><a href="#org11e46aa">2.2. package包管理配置</a></li>
<li><a href="#org34ff447">2.3. 安装use-package插件</a></li>
<li><a href="#org3c84484">2.4. quelpa包管理器</a></li>
<li><a href="#orgafc2fe2">2.5. auto-package-update</a></li>
<li><a href="#orgc513a0b">2.6. find-config</a></li>
<li><a href="#orge2ebc97">2.7. 加载模块化配置</a></li>
<li><a href="#orgae4695c">2.8. init.el 文件尾</a></li>
</ul>
</li>
<li><a href="#org550120b">3. init-ui.el</a>
<ul>
<li><a href="#orge2e9622">3.1. init-ui.el 文件头</a></li>
<li><a href="#orga072974">3.2. ef主题</a></li>
<li><a href="#org9c361e6">3.3. 字体设置</a></li>
<li><a href="#org9b73235">3.4. 窗口设置</a>
<ul>
<li><a href="#org4ae72b5">3.4.1. 调整启动窗口大小</a></li>
</ul>
</li>
<li><a href="#org25fe7f9">3.5. 其他UI零散设置项</a></li>
<li><a href="#org267fb70">3.6. 编码设置</a></li>
<li><a href="#orgbaeea60">3.7. 模式栏设置</a>
<ul>
<li><a href="#org982bbb6">3.7.1. doom-modeline插件</a></li>
<li><a href="#orgd72f7d7">3.7.2. minions插件</a></li>
<li><a href="#org9422ee8">3.7.3. keycast按键展示</a></li>
</ul>
</li>
<li><a href="#org631a7af">3.8. 图标设置</a></li>
<li><a href="#org087b552">3.9. shackle窗口管理</a></li>
<li><a href="#org6345e28">3.10. popper窗口弹出管理</a></li>
<li><a href="#org1858f7d">3.11. winner窗口管理</a></li>
<li><a href="#orgdaa4c83">3.12. Dashboard</a></li>
<li><a href="#orgbe432bc">3.13. line-number-mode</a></li>
<li><a href="#org2470c9f">3.14. ace-window</a></li>
<li><a href="#org8c0d2f2">3.15. 恢复单屏</a></li>
<li><a href="#org911debf">3.16. init-ui.el 文件尾</a></li>
</ul>
</li>
<li><a href="#orgfa82d3f">4. init-base.el</a>
<ul>
<li><a href="#org08978e3">4.1. init-base.el 文件头</a></li>
<li><a href="#orgcae5a60">4.2. no-littering让配置目录简洁</a></li>
<li><a href="#org9d010a0">4.3. saveplace记住每个文件的光标位置</a></li>
<li><a href="#org3745453">4.4. recentf最近打开的文件历史</a></li>
<li><a href="#orgaa7c52c">4.5. savehist</a></li>
<li><a href="#org6a7b717">4.6. crux系统增强</a></li>
<li><a href="#org25aede3">4.7. restart-emacs</a></li>
<li><a href="#orgc3ebbb5">4.8. 个人函数定义</a></li>
<li><a href="#org22a44a8">4.9. 设置代理</a></li>
<li><a href="#orgc6d6ab3">4.10. good-scroll</a></li>
<li><a href="#org324a93c">4.11. init-base.el 文件尾</a></li>
</ul>
</li>
<li><a href="#org83d7719">5. init-edit.el</a>
<ul>
<li><a href="#org7312de2">5.1. init-edit.el 文件头</a></li>
<li><a href="#orgc44c047">5.2. Emacs备份设置</a></li>
<li><a href="#org0bbbf4c">5.3. 解除一些不常用的快捷键</a></li>
<li><a href="#org789cb5f">5.4. delsel选择文本输入时直接替换</a></li>
<li><a href="#orgcf9eb17">5.5. 自动重载设置</a></li>
<li><a href="#org61b90dd">5.6. avy光标移动</a></li>
<li><a href="#orgb944446">5.7. multiple-cursors多光标编辑</a></li>
<li><a href="#org6ad596d">5.8. init-edit.el 文件尾</a></li>
</ul>
</li>
<li><a href="#org691c8bc">6. init-org.el</a>
<ul>
<li><a href="#org7ac216b">6.1. init-org.el 文件头</a></li>
<li><a href="#org749ecb5">6.2. org-mode</a></li>
<li><a href="#org6d2f243">6.3. Org-modern</a></li>
<li><a href="#orgd547c98">6.4. org-appear</a></li>
<li><a href="#org2742824">6.5. org-auto-tangle</a></li>
<li><a href="#org70d71c4">6.6. org-src</a></li>
<li><a href="#org94435be">6.7. limit the babel result length</a></li>
<li><a href="#org88c3c04">6.8. 导出为中文</a></li>
<li><a href="#org2a820b9">6.9. 显示数学公式</a></li>
<li><a href="#orgf8561e1">6.10. org-download实现粘贴复制图片到orgmode</a></li>
<li><a href="#orgbd5ba66">6.11. toc-org目录自动生成</a></li>
<li><a href="#org3c5bcdc">6.12. ol新增链接类型</a></li>
<li><a href="#org343076d">6.13. org mode auto update date</a></li>
<li><a href="#org2e46fa9">6.14. init-org.el 文件尾</a></li>
</ul>
</li>
<li><a href="#org9bedd77">7. init-completion.el</a>
<ul>
<li><a href="#org61e1cda">7.1. init-completion.el 文件头</a></li>
<li><a href="#org0046bf8">7.2. consult</a></li>
<li><a href="#orgdbf61ca">7.3. vertico</a></li>
<li><a href="#org2de9125">7.4. orderless</a></li>
<li><a href="#orgbc5f19e">7.5. marginalia</a></li>
<li><a href="#org828223e">7.6. corfu</a></li>
<li><a href="#org99e7aa3">7.7. cape</a></li>
<li><a href="#org42ec777">7.8. completion</a></li>
<li><a href="#orgdfdcb8a">7.9. lsp-mode</a></li>
<li><a href="#org867c76b">7.10. eglot</a></li>
<li><a href="#orge34daa2">7.11. yasnippet模板补全</a></li>
<li><a href="#org00f73d0">7.12. all-the-icons-completion补全图标美化</a></li>
<li><a href="#org3ff2979">7.13. smartparens</a></li>
<li><a href="#org5570d6d">7.14. paren高亮匹配的括号</a></li>
<li><a href="#org0205921">7.15. rainbow-delimeters多彩括号</a></li>
<li><a href="#org7601500">7.16. init-completion.el 文件尾</a></li>
</ul>
</li>
<li><a href="#orgd2ca19c">8. init-dired.el</a>
<ul>
<li><a href="#org5951f20">8.1. init-dired.el 文件头</a></li>
<li><a href="#orgf698e73">8.2. diredfl多彩美化</a></li>
<li><a href="#orge68481b">8.3. all-the-icons-dired图标美化</a></li>
<li><a href="#orgf220757">8.4. dirvish文件管理</a></li>
<li><a href="#orgcacc9cc">8.5. init-dired.el 文件尾</a></li>
</ul>
</li>
<li><a href="#orge0bd352">9. Init-shell.el</a>
<ul>
<li><a href="#orgbc7a20d">9.1. init-shell.el 文件头</a></li>
<li><a href="#orga5ab39a">9.2. eshell 基本配置</a></li>
<li><a href="#org931576b">9.3. eshell alias 设置</a></li>
<li><a href="#org34e8ffd">9.4. eshell 里的 C-d</a></li>
<li><a href="#orgc6eb8b3">9.5. Eshell 的命令历史</a></li>
<li><a href="#orgc85f77e">9.6. 有些命令使用 term</a></li>
<li><a href="#org7b83cb5">9.7. eshell-git-prompt 命令行主题</a></li>
<li><a href="#orgcd02a61">9.8. eshell-syntax-highlighting 语法高亮</a></li>
<li><a href="#org35b5856">9.9. esh-autosuggest自动补全</a></li>
<li><a href="#org94c2d3b">9.10. eshell-up快速进入父级文件夹</a></li>
<li><a href="#org5924556">9.11. eshell 快捷键</a></li>
<li><a href="#org4656b35">9.12. shell</a></li>
<li><a href="#orga42a7b8">9.13. init-shell.el 文件尾</a></li>
</ul>
</li>
<li><a href="#org682629a">10. init-tools.el</a>
<ul>
<li><a href="#org0b26027">10.1. init-tools.el 文件头</a></li>
<li><a href="#org6ea8c1b">10.2. helpful帮助增强</a></li>
<li><a href="#orgb135492">10.3. which-key快捷键</a></li>
<li><a href="#orgaf1a904">10.4. pyvenv-auto</a></li>
<li><a href="#orgd79e723">10.5. vc设置</a></li>
<li><a href="#orgf6f87b3">10.6. magit版本管理</a></li>
<li><a href="#org7934282">10.7. diff-hl高亮显示修改的部分</a></li>
<li><a href="#orga04833e">10.8. magit-delta增强git diff</a></li>
<li><a href="#org685ceda">10.9. swiper(find-help)</a></li>
<li><a href="#orgf478be9">10.10. eaf</a></li>
<li><a href="#orga0e0d09">10.11. init-tools.el 文件尾</a></li>
</ul>
</li>
<li><a href="#orgdd70590">11. init-note.el</a>
<ul>
<li><a href="#orgd55de26">11.1. init-note.el 文件头</a></li>
<li><a href="#org547cafd">11.2. org-ai</a></li>
<li><a href="#orgd651111">11.3. org-noter</a></li>
<li><a href="#org57e4456">11.4. org-roam</a></li>
<li><a href="#org6fb4f52">11.5. rime</a></li>
<li><a href="#org29d736e">11.6. youdao dictionary</a></li>
<li><a href="#org2e525b3">11.7. plantuml绘图</a></li>
<li><a href="#orgde999ef">11.8. gnuplot绘图</a></li>
<li><a href="#org564bd19">11.9. org-capture快速记录设置</a></li>
<li><a href="#orgf9732e0">11.10. whisper</a></li>
<li><a href="#orge0bba10">11.11. init-note.el 文件尾</a></li>
</ul>
</li>
<li><a href="#orgf17473e">12. Init-language.el</a>
<ul>
<li><a href="#orgc5a11fa">12.1. init-language.el 文件头</a></li>
<li><a href="#orga5b733e">12.2. Python-mode</a></li>
<li><a href="#orgba25a1e">12.3. Rust-mode</a></li>
<li><a href="#org3dcb68b">12.4. emacs-lisp-mode</a></li>
<li><a href="#org359052b">12.5. lua-moode</a></li>
<li><a href="#org9cd1dea">12.6. c-mode</a></li>
<li><a href="#org652f294">12.7. init-language.el 文件尾</a></li>
</ul>
</li>
<li><a href="#org8ed4ffd">13. init-hugo.el</a>
<ul>
<li><a href="#org9e728d8">13.1. init-hugo.el文件头</a></li>
<li><a href="#org8b67b62">13.2. ox-hugo</a></li>
<li><a href="#org019ff5a">13.3. deploy-hugo</a></li>
<li><a href="#orga4143ba">13.4. init-hugo.el 文件尾</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgc234569" class="outline-2">
<h2 id="orgc234569"><span class="section-number-2">1.</span> early-init.el</h2>
<div class="outline-text-2" id="text-1">
<p>
在Emacs刚启动，还未加载主要配置文件时的配置文件。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; early-init.el --- Emacs pre-initialization config -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

;; 设置垃圾回收参数
(setq gc-cons-threshold most-positive-fixnum)
(setq gc-cons-percentage 0.6)

;; 启动早期不加载`package.el'包管理器
(setq package-enable-at-startup nil)
;; 不从包缓存中加载
(setq package-quickstart nil)

;; 禁止展示菜单栏、工具栏和纵向滚动条
(push '(menu-bar-lines . 0) default-frame-alist)
(push '(tool-bar-lines . 0) default-frame-alist)
(push '(vertical-scroll-bars) default-frame-alist)

;; 禁止自动缩放窗口先
(setq frame-inhibit-implied-resize t)

;; 禁止菜单栏、工具栏、滚动条模式，禁止启动屏幕和文件对话框
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)
(setq inhibit-splash-screen t)
(setq use-file-dialog nil)

;; 在这个阶段不编译
(setq comp-deferred-compilation nil)

(provide 'early-init)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; early-init.el ends here
</pre>
</div>
</div>
</div>

<div id="outline-container-org888f83b" class="outline-2">
<h2 id="org888f83b"><span class="section-number-2">2.</span> init.el</h2>
<div class="outline-text-2" id="text-2">
<p>
<code>init.el</code> 是Emacs的主要配置文件。
</p>
</div>

<div id="outline-container-orgb2dcb75" class="outline-3">
<h3 id="orgb2dcb75"><span class="section-number-3">2.1.</span> init.el 文件头</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init.el --- The main init entry for Emacs -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-org11e46aa" class="outline-3">
<h3 id="org11e46aa"><span class="section-number-3">2.2.</span> package包管理配置</h3>
<div class="outline-text-3" id="text-2-2">
<p>
设置镜像为中科大源
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(require 'package)
(setq package-archives
	  '(("melpa-stable" . "http://mirrors.tuna.tsinghua.edu.cn/elpa/stable-melpa/")
        ("melpa"  . "https://mirrors.ustc.edu.cn/elpa/melpa/")
	    ("gnu"    . "https://mirrors.ustc.edu.cn/elpa/gnu/")
        ("gnu-devel" . "https://mirrors.ustc.edu.cn/elpa/gnu-devel/")
        ("nognu-devel" . "https://mirrors.ustc.edu.cn/elpa/nongnu-devel/")
	    ("nongnu" . "https://mirrors.ustc.edu.cn/elpa/nongnu/")))

(package-initialize)
</pre>
</div>
</div>
</div>

<div id="outline-container-org34ff447" class="outline-3">
<h3 id="org34ff447"><span class="section-number-3">2.3.</span> 安装use-package插件</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<a href="https://github.com/jwiegley/use-package">use-package</a> 是一个让Emacs配置更加结构化更加清晰的一个宏插件。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 安装 `use-package'
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

;; 配置 `use-package'
(eval-and-compile
  (setq use-package-always-ensure nil)
  (setq use-package-always-defer nil)
  (setq use-package-expand-minimally nil)
  (setq use-package-enable-imenu-support t)
  (if (daemonp)
	  (setq use-package-always-demand t)))

(eval-when-compile
  (require 'use-package))

;; 安装 `use-package' 的集成模块
(use-package use-package-ensure-system-package
  :ensure t)
(use-package diminish
  :ensure t)
(use-package bind-key
  :ensure t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c84484" class="outline-3">
<h3 id="org3c84484"><span class="section-number-3">2.4.</span> quelpa包管理器</h3>
<div class="outline-text-3" id="text-2-4">
<p>
<a href="https://github.com/quelpa/quelpa">quelpa</a> 是配合 <code>package.el</code> 使用的，基于git的一个包管理器。
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 安装 `quelpa'
(use-package quelpa
  :ensure t
  :commands quelpa
  :config
  :custom
  (quelpa-git-clone-depth 1)
  (quelpa-update-melpa-p nil)
  (quelpa-self-upgrade-p nil)
  (quelpa-checkout-melpa-p nil))

;; `quelpa' 与 `use-package' 集成
(use-package quelpa-use-package
  :ensure t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgafc2fe2" class="outline-3">
<h3 id="orgafc2fe2"><span class="section-number-3">2.5.</span> auto-package-update</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package auto-package-update)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc513a0b" class="outline-3">
<h3 id="orgc513a0b"><span class="section-number-3">2.6.</span> find-config</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun open-custom-post-file()
  "This functions dose finde custom-post.el."
  (interactive)
  (find-file "~/.emacs.d/emacs-config.org"))
(global-set-key (kbd "&lt;f5&gt;") 'open-custom-post-file)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2ebc97" class="outline-3">
<h3 id="orge2ebc97"><span class="section-number-3">2.7.</span> 加载模块化配置</h3>
<div class="outline-text-3" id="text-2-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">  ;; 将lisp目录放到加载路径的前面以加快启动速度
  (let ((dir (locate-user-emacs-file "lisp")))
    (add-to-list 'load-path (file-name-as-directory dir)))

  ;; 加载各模块化配置
  ;; 不要在`*message*'缓冲区显示加载模块化配置的信息
  (with-temp-message ""
    (require 'init-ui)                    ; UI交互
    (require 'init-edit)                  ; 编辑行为
    (require 'init-org)                   ; org相关设置
    (require 'init-completion)            ; 补全系统
    (require 'init-tools)                 ; 相关工具
    (require 'init-base)                  ; 一些基本配置
    (require 'init-shell)                 ;shell设置
    (require 'init-note)                  ; 写作相关配置
    (require 'init-language)              ; 编程语言设置
    (require 'init-hugo)                  ; 发布博客设置
    )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae4695c" class="outline-3">
<h3 id="orgae4695c"><span class="section-number-3">2.8.</span> init.el 文件尾</h3>
<div class="outline-text-3" id="text-2-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org550120b" class="outline-2">
<h2 id="org550120b"><span class="section-number-2">3.</span> init-ui.el</h2>
<div class="outline-text-2" id="text-3">
</div>

<div id="outline-container-orge2e9622" class="outline-3">
<h3 id="orge2e9622"><span class="section-number-3">3.1.</span> init-ui.el 文件头</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-ui.el --- UI settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orga072974" class="outline-3">
<h3 id="orga072974"><span class="section-number-3">3.2.</span> ef主题</h3>
<div class="outline-text-3" id="text-3-2">
<p>
<a href="https://protesilaos.com/emacs/ef-themes">ef themes</a> 是我非常喜欢的一个主题包。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ef-themes
  :ensure t
  :bind (
         ( "C-c t" . ef-themes-toggle)
         ("C-c e r" . ef-themes-load-random)
         )
  :init
  ;; set two specific themes and switch between them
  (setq ef-themes-to-toggle '(ef-summer ef-winter))
  ;; set org headings and function syntax
  (setq ef-themes-headings
        '((0 . (bold 1))
          (1 . (bold 1))
          (2 . (rainbow bold 1))
          (3 . (rainbow bold 1))
          (4 . (rainbow bold 1))
          (t . (rainbow bold 1))))
  (setq ef-themes-region '(intense no-extend neutral))
  ;; Disable all other themes to avoid awkward blending:
  (mapc #'disable-theme custom-enabled-themes)

  ;; Load the theme of choice:
  ;; The themes we provide are recorded in the `ef-themes-dark-themes',
  ;; `ef-themes-light-themes'.
  
  ;; 如果你不喜欢随机主题，也可以直接固定选择一个主题，如下：
  (ef-themes-select 'ef-summer)

  ;; 随机挑选一款主题，如果是命令行打开Emacs，则随机挑选一款黑色主题
  ;; (if (display-graphic-p)
  ;;     (ef-themes-load-random)
  ;;   (ef-themes-load-random 'dark))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c361e6" class="outline-3">
<h3 id="org9c361e6"><span class="section-number-3">3.3.</span> 字体设置</h3>
<div class="outline-text-3" id="text-3-3">
<p>
<a href="https://protesilaos.com/emacs/fontaine">fontaine</a> 插件可以根据需要高度定制字体。
</p>

<blockquote>
<p>
这篇文章可以作为字体设置的参考：
<a href="http://xahlee.info/emacs/emacs/emacs_list_and_set_font.html">http://xahlee.info/emacs/emacs/emacs_list_and_set_font.html</a>
</p>
</blockquote>

<table id="org0cde88b" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> 测试中英文字体对齐</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">中文</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">abcd</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package fontaine
  :ensure t
  :when (display-graphic-p)
  ;; :hook (kill-emacs . fontaine-store-latest-preset)
  :config
  (setq fontaine-latest-state-file
        (locate-user-emacs-file "etc/fontaine-latest-state.eld"))
  (setq fontaine-presets
        '((regular
           :default-height 140
           :default-weight regular
           :fixed-pitch-height 1.0
           :variable-pitch-height 1.0
           )
          (large
           :default-height 180
           :default-weight normal
           :fixed-pitch-height 1.0
           :variable-pitch-height 1.05
           )
          (t
           :default-family "Source Code Pro"
           :fixed-pitch-family "Source Code Pro"
           :variable-pitch-family "Source Code Pro"
           :italic-family "Source Code Pro"
           :variable-pitch-weight normal
           :bold-weight normal
           :italic-slant italic
           :line-spacing 0.1)
          ))
  ;; (fontaine-set-preset (or (fontaine-restore-latest-preset) 'regular))
  (fontaine-set-preset 'regular)

  ;; set emoji font
  (set-fontset-font
   t
   (if (version&lt; emacs-version "28.1")
       '(#x1f300 . #x1fad0)
     'emoji)
   (cond
    ((member "Noto Emoji" (font-family-list)) "Noto Emoji")
    ((member "Symbola" (font-family-list)) "Symbola")
    ((member "Noto Color Emoji" (font-family-list)) "Noto Color Emoji")
    ((member "Segoe UI Emoji" (font-family-list)) "Segoe UI Emoji")
    ))

  ;; set Chinese font
  (dolist (charset '(kana han symbol cjk-misc bopomofo))
    (set-fontset-font
     (frame-parameter nil 'font)
     charset
     (font-spec :family
                (cond
                 ((eq system-type 'darwin)
                  (cond
                   ((member "Sarasa Mono SC Nerd" (font-family-list)) "Sarasa Mono SC Nerd")
                   ((member "PingFang SC" (font-family-list)) "PingFang SC")
                   ((member "WenQuanYi Zen Hei" (font-family-list)) "WenQuanYi Zen Hei")
                   ))
                 ((eq system-type 'gnu/linux)
                  (cond
                   ((member "Sarasa Mono SC Nerd" (font-family-list)) "Sarasa Mono SC Nerd")
                   ((member "WenQuanYi Zen Hei" (font-family-list)) "WenQuanYi Zen Hei")
                   ))
                 (t
                  (cond
                   ((member "Sarasa Mono SC Nerd" (font-family-list)) "Sarasa Mono SC Nerd")
                   ((member "Microsoft YaHei" (font-family-list)) "Microsoft YaHei")
                   )))
                )))

  ;; set Chinese font scale
  (setq face-font-rescale-alist `(
                                  ("Symbola"             . 1.3)
                                  ("WenQuanYi Zen Hei"   . 1.2)
                                  ("Sarasa Mono SC Nerd" . 1.2)
                                  ("PingFang SC"         . 1.16)
                                  ("Lantinghei SC"       . 1.16)
                                  ("Kaiti SC"            . 1.16)
                                  ("Yuanti SC"           . 1.16)
                                  ))
  )


(defun set-emacsclient-font ()
  "Set the font for Emacs client frames."
  (let ((chinese-font "WenQuanYi Zen Hei")   ; 设置中文字体名称
        (english-font "Source Code Pro")        ; 设置英文字体名称
        (font-size 18)                         ; 设置字体大小
        (chinese-font-scale 1.2))               ; 设置中文字体缩放比例
    (set-face-attribute 'default nil :family english-font :height (* font-size 10))
    (set-fontset-font t 'han (font-spec :family chinese-font))
    (setq face-font-rescale-alist `(
                                     ("WenQuanYi Zen Hei"   . 1.2)
                                    ))
    )
  )

(add-hook 'after-make-frame-functions
          (lambda (frame)
            (select-frame frame)
            (when (window-system frame)
              (set-emacsclient-font))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b73235" class="outline-3">
<h3 id="org9b73235"><span class="section-number-3">3.4.</span> 窗口设置</h3>
<div class="outline-text-3" id="text-3-4">
</div>
<div id="outline-container-org4ae72b5" class="outline-4">
<h4 id="org4ae72b5"><span class="section-number-4">3.4.1.</span> 调整启动窗口大小</h4>
<div class="outline-text-4" id="text-3-4-1">
<p>
在Mac下，我的默认启动窗口大小
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 设置窗口大小，仅仅在图形界面需要设置
(when (display-graphic-p)
  (let ((top    0)                                     ; 顶不留空
        (left   (/ (x-display-pixel-width) 10))        ; 左边空10%
        (height (round (* 0.8                          ; 窗体高度为0.8倍的显示高度
                          (/ (x-display-pixel-height)
                             (frame-char-height))))))
    (let ((width  (round (* 2.5 height))))             ; 窗体宽度为2.5倍高度
      (setq default-frame-alist nil)
      (add-to-list 'default-frame-alist (cons 'top top))
      (add-to-list 'default-frame-alist (cons 'left left))
      (add-to-list 'default-frame-alist (cons 'height height))
      (add-to-list 'default-frame-alist (cons 'width width)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org25fe7f9" class="outline-3">
<h3 id="org25fe7f9"><span class="section-number-3">3.5.</span> 其他UI零散设置项</h3>
<div class="outline-text-3" id="text-3-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 禁用一些GUI特性
(setq use-dialog-box nil)               ; 鼠标操作不使用对话框
(setq inhibit-default-init t)           ; 不加载 `default' 库
(setq inhibit-startup-screen t)         ; 不加载启动画面
(setq inhibit-startup-message t)        ; 不加载启动消息
(setq inhibit-startup-buffer-menu t)    ; 不显示缓冲区列表

;; 草稿缓冲区默认文字设置
(setq initial-scratch-message (concat ";; Happy hacking, "
                                      (capitalize user-login-name) " - Emacs ♥ you!\n\n"))

;; 设置缓冲区的文字方向为从左到右
(setq bidi-paragraph-direction 'left-to-right)
;; 禁止使用双向括号算法
;; (setq bidi-inhibit-bpa t)

;; 设置自动折行宽度为80个字符，默认值为70
(setq-default fill-column 80)

;; 设置大文件阈值为100MB，默认10MB
(setq large-file-warning-threshold 100000000)

;; 以16进制显示字节数
(setq display-raw-bytes-as-hex t)
;; 有输入时禁止 `fontification' 相关的函数钩子，能让滚动更顺滑
(setq redisplay-skip-fontification-on-input t)

;; 禁止响铃
(setq ring-bell-function 'ignore)

;; 禁止闪烁光标
(blink-cursor-mode -1)

;; 在光标处而非鼠标所在位置粘贴
(setq mouse-yank-at-point t)

;; 拷贝粘贴设置
(setq select-enable-primary nil)        ; 选择文字时不拷贝
(setq select-enable-clipboard t)        ; 拷贝时使用剪贴板

;; 鼠标滚动设置
(setq scroll-step 2)
(setq scroll-margin 2)
(setq hscroll-step 2)
(setq hscroll-margin 2)
(setq scroll-conservatively 101)
(setq scroll-up-aggressively 0.01)
(setq scroll-down-aggressively 0.01)
(setq scroll-preserve-screen-position 'always)

;; 对于高的行禁止自动垂直滚动
(setq auto-window-vscroll nil)

;; 设置新分屏打开的位置的阈值
(setq split-width-threshold (assoc-default 'width default-frame-alist))
(setq split-height-threshold nil)

;; TAB键设置，在Emacs里不使用TAB键，所有的TAB默认为4个空格
(setq-default indent-tabs-mode nil)
(setq-default tab-width 4)

;; yes或no提示设置，通过下面这个函数设置当缓冲区名字匹配到预设的字符串时自动回答yes
(setq original-y-or-n-p 'y-or-n-p)
(defalias 'original-y-or-n-p (symbol-function 'y-or-n-p))
(defun default-yes-sometimes (prompt)
  "automatically say y when buffer name match following string"
  (if (or
	   (string-match "has a running process" prompt)
	   (string-match "does not exist; create" prompt)
	   (string-match "modified; kill anyway" prompt)
	   (string-match "Delete buffer using" prompt)
	   (string-match "Kill buffer of" prompt)
	   (string-match "still connected.  Kill it?" prompt)
	   (string-match "Shutdown the client's kernel" prompt)
	   (string-match "kill them and exit anyway" prompt)
	   (string-match "Revert buffer from file" prompt)
	   (string-match "Kill Dired buffer of" prompt)
	   (string-match "delete buffer using" prompt)
       (string-match "Kill all pass entry" prompt)
       (string-match "for all cursors" prompt)
	   (string-match "Do you want edit the entry" prompt))
	  t
    (original-y-or-n-p prompt)))
(defalias 'yes-or-no-p 'default-yes-sometimes)
(defalias 'y-or-n-p 'default-yes-sometimes)

;; 设置剪贴板历史长度300，默认为60
(setq kill-ring-max 200)

;; 在剪贴板里不存储重复内容
(setq kill-do-not-save-duplicates t)

;; 设置位置记录长度为6，默认为16
;; 可以使用 `counsel-mark-ring' or `consult-mark' (C-x j) 来访问光标位置记录
;; 使用 C-x C-SPC 执行 `pop-global-mark' 直接跳转到上一个全局位置处
;; 使用 C-u C-SPC 跳转到本地位置处
(setq mark-ring-max 6)
(setq global-mark-ring-max 6)

;; 设置 emacs-lisp 的限制
(setq max-lisp-eval-depth 10000)        ; 默认值为 800
(setq max-specpdl-size 10000)           ; 默认值为 1600

;; 启用 `list-timers', `list-threads' 这两个命令
(put 'list-timers 'disabled nil)
(put 'list-threads 'disabled nil)

;; 在命令行里支持鼠标
(xterm-mouse-mode 1)

;; 退出Emacs时进行确认
(setq confirm-kill-emacs 'y-or-n-p)

;; 在模式栏上显示当前光标的列号
(column-number-mode t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org267fb70" class="outline-3">
<h3 id="org267fb70"><span class="section-number-3">3.6.</span> 编码设置</h3>
<div class="outline-text-3" id="text-3-6">
<p>
统一使用 UTF-8 编码。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 配置所有的编码为UTF-8，参考：
;; https://thraxys.wordpress.com/2016/01/13/utf-8-in-emacs-everywhere-forever/
(setq locale-coding-system 'utf-8)
(set-terminal-coding-system 'utf-8)
(set-keyboard-coding-system 'utf-8)
(set-selection-coding-system 'utf-8)
(set-default-coding-systems 'utf-8)
(set-language-environment 'utf-8)
(set-clipboard-coding-system 'utf-8)
(set-file-name-coding-system 'utf-8)
(set-buffer-file-coding-system 'utf-8)
(prefer-coding-system 'utf-8)
(modify-coding-system-alist 'process "*" 'utf-8)
(when (display-graphic-p)
  (setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbaeea60" class="outline-3">
<h3 id="orgbaeea60"><span class="section-number-3">3.7.</span> 模式栏设置</h3>
<div class="outline-text-3" id="text-3-7">
</div>
<div id="outline-container-org982bbb6" class="outline-4">
<h4 id="org982bbb6"><span class="section-number-4">3.7.1.</span> doom-modeline插件</h4>
<div class="outline-text-4" id="text-3-7-1">
<p>
<a href="https://github.com/seagle0128/doom-modeline">doom-modeline</a> 是一个模式栏美化插件。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package doom-modeline
  :ensure t
  :hook (after-init . doom-modeline-mode)
  :custom
  (doom-modeline-irc nil)
  (doom-modeline-mu4e nil)
  (doom-modeline-gnus nil)
  (doom-modeline-github nil)
  (doom-modeline-buffer-file-name-style 'truncate-upto-root) ; : auto
  (doom-modeline-persp-name nil)
  (doom-modeline-unicode-fallback t)
  (doom-modeline-enable-word-count nil))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd72f7d7" class="outline-4">
<h4 id="orgd72f7d7"><span class="section-number-4">3.7.2.</span> minions插件</h4>
<div class="outline-text-4" id="text-3-7-2">
<p>
<a href="https://github.com/tarsius/minions">minions</a> 插件能让模式栏变得清爽，将次要模式隐藏起来。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package minions
  :ensure t
  :hook (after-init . minions-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9422ee8" class="outline-4">
<h4 id="org9422ee8"><span class="section-number-4">3.7.3.</span> keycast按键展示</h4>
<div class="outline-text-4" id="text-3-7-3">
<p>
<a href="https://github.com/tarsius/keycast">keycast mode</a> 插件可以在模式栏上展示所有的按键，以及对应的函数。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package keycast
  :ensure t
  :hook (after-init . keycast-mode)
  :config
  ;; set for doom-modeline support
  ;; With the latest change 72d9add, mode-line-keycast needs to be modified to keycast-mode-line.
  (define-minor-mode keycast-mode
    "Show current command and its key binding in the mode line (fix for use with doom-mode-line)."
    :global t
    (if keycast-mode
        (progn
          (add-hook 'pre-command-hook 'keycast--update t)
          (add-to-list 'global-mode-string '("" keycast-mode-line "  ")))
      (remove-hook 'pre-command-hook 'keycast--update)
      (setq global-mode-string (delete '("" keycast-mode-line "  ") global-mode-string))
      ))

  (dolist (input '(self-insert-command
                   org-self-insert-command))
    (add-to-list 'keycast-substitute-alist `(,input "." "Typing…")))

  (dolist (event '(mouse-event-p
                   mouse-movement-p
                   mwheel-scroll))
    (add-to-list 'keycast-substitute-alist `(,event nil)))

  (setq keycast-log-format "%-20K%C\n")
  (setq keycast-log-frame-alist
        '((minibuffer . nil)))
  (setq keycast-log-newest-first t)
  )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org631a7af" class="outline-3">
<h3 id="org631a7af"><span class="section-number-3">3.8.</span> 图标设置</h3>
<div class="outline-text-3" id="text-3-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package all-the-icons
  :ensure t
  :when (display-graphic-p)
  :commands all-the-icons-install-fonts
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org087b552" class="outline-3">
<h3 id="org087b552"><span class="section-number-3">3.9.</span> shackle窗口管理</h3>
<div class="outline-text-3" id="text-3-9">
<p>
<a href="https://depp.brause.cc/shackle/">shackle</a> 插件能自定义窗口的弹出方式。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package shackle
  :ensure t
  :hook (after-init . shackle-mode)
  :init
  (setq shackle-lighter "")
  (setq shackle-select-reused-windows nil) ; default nil
  (setq shackle-default-alignment 'below)  ; default below
  (setq shackle-default-size 0.4)          ; default 0.5
  (setq shackle-rules
        ;; CONDITION(:regexp)            :select     :inhibit-window-quit   :size+:align|:other     :same|:popup
        '((compilation-mode              :ignore t)
          ("\\*Async Shell.*\\*" :regexp t :ignore t)
          ("\\*corfu.*\\*"       :regexp t :ignore t)
          (helpful-mode                  :select t                          :size 0.3  :align below :popup t)
          ("*Messages*"                  :select t                          :size 0.4  :align t     :popup t)
          ("*Calendar*"                  :select t                          :size 0.3  :align t     :popup t)
          ("*info*"                      :select t                                                  :same t)
          (magit-status-mode             :select t   :inhibit-window-quit t                         :same t)
          (magit-log-mode                :select t   :inhibit-window-quit t                         :same t)
          ))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org6345e28" class="outline-3">
<h3 id="org6345e28"><span class="section-number-3">3.10.</span> popper窗口弹出管理</h3>
<div class="outline-text-3" id="text-3-10">
<p>
我们通过 <a href="https://github.com/karthink/popper">popper</a> 插件，来控制窗口的弹出行为，与 <a href="https://depp.brause.cc/shackle/">shackle</a> 一起配合使用。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package popper
  :ensure t
  :bind (("M-`"     . popper-toggle-latest)
         ("M-&lt;tab&gt;" . popper-cycle)
         ("M-\\"    . popper-toggle-type)
         )
  :init
  (setq popper-reference-buffers
        '("\\*Messages\\*"
          "\\*Async Shell Command\\*"
          help-mode
          helpful-mode
          occur-mode
          pass-view-mode
          ("\\*corfu\\*" . hide)
          (compilation-mode . hide)
          ;; derived from `fundamental-mode' and fewer than 10 lines will be considered a popup
          (lambda (buf) (with-current-buffer buf
                          (and (derived-mode-p 'fundamental-mode)
                               (&lt; (count-lines (point-min) (point-max))
                                  10))))
          )
        )
  (popper-mode +1)
  (popper-echo-mode +1)
  :config
  ;; group by project.el, projectile, directory or perspective
  (setq popper-group-function nil)
  
  ;; pop in child frame or not
  (setq popper-display-function #'display-buffer-in-child-frame)

  ;; use `shackle.el' to control popup
  (setq popper-display-control nil)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org1858f7d" class="outline-3">
<h3 id="org1858f7d"><span class="section-number-3">3.11.</span> winner窗口管理</h3>
<div class="outline-text-3" id="text-3-11">
<p>
内置的 <code>winner</code> 插件是一个窗口管理器，可以通过 <code>winner-undo</code> 和 <code>winner-redo</code> 命令恢复或重做窗口布局。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package winner
  :ensure nil
  :hook (after-init . winner-mode)
  :commands (winner-undo winner-redo)
  :config
  (setq winner-boring-buffers
        '("*Completions*"
          "*Compile-Log*"
          "*inferior-lisp*"
          "*Fuzzy Completions*"
          "*Apropos*"
          "*Help*"
          "*cvs*"
          "*Buffer List*"
          "*Ibuffer*"
          "*esh command on file*"))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdaa4c83" class="outline-3">
<h3 id="orgdaa4c83"><span class="section-number-3">3.12.</span> Dashboard</h3>
<div class="outline-text-3" id="text-3-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dashboard
  :ensure t
  :init
  (progn
    ;; Set the title
    (setq dashboard-banner-logo-title "Welcom Inkwell Emacs")
    ;; Set the banner
    (setq dashboard-startup-banner "/home/elon/.emacs.d/logo.png")
    ;; Content is not centered by default. To center, set
    (setq dashboard-center-content t)
    (setq dashboard-set-heading-icons t)
    (setq dashboard-icon-type 'all-the-icons)
    (setq dashboard-set-file-icons t)
    )
  :config
  (dashboard-setup-startup-hook)

  ;; Customize the dashboard items
  (setq dashboard-items '((recents . 6)
                          (bookmarks . 6)
                          (agenda . 6)))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe432bc" class="outline-3">
<h3 id="orgbe432bc"><span class="section-number-3">3.13.</span> line-number-mode</h3>
<div class="outline-text-3" id="text-3-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 在编程模式下显示行号
(add-hook 'prog-mode-hook 'display-line-numbers-mode)
;; 在其他模式下禁用行号显示
(global-display-line-numbers-mode -1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2470c9f" class="outline-3">
<h3 id="org2470c9f"><span class="section-number-3">3.14.</span> ace-window</h3>
<div class="outline-text-3" id="text-3-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">  (use-package ace-window
    :ensure t
    :init
    (setq aw-keys '(?1 ?2 ?3 ?4 ?5 ?6 ?7 ?8 ?9))
    :config
    ;; 增大数字跳转显示的字体大小
    (custom-set-faces
     '(aw-leading-char-face ((t (:height 2.0 :foreground "red")))))
    :bind (("C-x o" . ace-window))
  )


</pre>
</div>
</div>
</div>

<div id="outline-container-org8c0d2f2" class="outline-3">
<h3 id="org8c0d2f2"><span class="section-number-3">3.15.</span> 恢复单屏</h3>
<div class="outline-text-3" id="text-3-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun my-kill-buffer-and-close-window ()
  "Kill the current buffer and close its window."
  (interactive)
  (let ((current-window (selected-window))
        (buffer-to-kill (current-buffer)))
    (kill-buffer buffer-to-kill)
    (delete-window current-window)))

(global-set-key (kbd "C-x k") 'my-kill-buffer-and-close-window)
</pre>
</div>
</div>
</div>

<div id="outline-container-org911debf" class="outline-3">
<h3 id="org911debf"><span class="section-number-3">3.16.</span> init-ui.el 文件尾</h3>
<div class="outline-text-3" id="text-3-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-ui)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-ui.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfa82d3f" class="outline-2">
<h2 id="orgfa82d3f"><span class="section-number-2">4.</span> init-base.el</h2>
<div class="outline-text-2" id="text-4">
</div>

<div id="outline-container-org08978e3" class="outline-3">
<h3 id="org08978e3"><span class="section-number-3">4.1.</span> init-base.el 文件头</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-base.el --- Basical settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orgcae5a60" class="outline-3">
<h3 id="orgcae5a60"><span class="section-number-3">4.2.</span> no-littering让配置目录简洁</h3>
<div class="outline-text-3" id="text-4-2">
<p>
<a href="https://github.com/emacscollective/no-littering">no-littering</a> 插件将原本放在 <code>.emacs.d</code> 目录下的一些配置信息或动态信息，转移到 <code>etc</code> 或 <code>var</code> 子目录里，让配置目录更加简洁清爽。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package no-littering
  :ensure t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d010a0" class="outline-3">
<h3 id="org9d010a0"><span class="section-number-3">4.3.</span> saveplace记住每个文件的光标位置</h3>
<div class="outline-text-3" id="text-4-3">
<p>
自动记住每个文件的最后一次访问的光标位置。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package saveplace
  :ensure nil
  :hook (after-init . save-place-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3745453" class="outline-3">
<h3 id="org3745453"><span class="section-number-3">4.4.</span> recentf最近打开的文件历史</h3>
<div class="outline-text-3" id="text-4-4">
<p>
记住最近打开的文件历史。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package recentf
  :ensure nil
  :defines no-littering-etc-directory no-littering-var-directory
  :hook (after-init . recentf-mode)
  :custom
  (recentf-max-saved-items 300)
  (recentf-auto-cleanup 'never)
  ;; `recentf-add-file' will apply handlers first, then call `string-prefix-p'
  ;; to check if it can be pushed to recentf list.
  (recentf-filename-handlers '(abbreviate-file-name))
  (recentf-exclude `(,@(cl-loop for f in `(,package-user-dir
                                           ,no-littering-var-directory
                                           ,no-littering-etc-directory)
                                collect (abbreviate-file-name f))
                     ;; Folders on MacOS start
                     "^/private/tmp/"
                     "^/var/folders/"
                     ;; Folders on MacOS end
                     ".cache"
                     ".cask"
                     ".elfeed"
                     "elfeed"
                     "bookmarks"
                     "cache"
                     "ido.*"
                     "persp-confs"
                     "recentf"
                     "undo-tree-hist"
                     "url"
                     "^/tmp/"
                     "/ssh\\(x\\)?:"
                     "/su\\(do\\)?:"
                     "^/usr/include/"
                     "/TAGS\\'"
                     "COMMIT_EDITMSG\\'")))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa7c52c" class="outline-3">
<h3 id="orgaa7c52c"><span class="section-number-3">4.5.</span> savehist</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package savehist
  :ensure nil
  :hook (after-init . savehist-mode)
  :config
  ;; Allow commands in minibuffers, will affect `dired-do-dired-do-find-regexp-and-replace' command:
  (setq enable-recursive-minibuffers t)
  (setq history-length 1000)
  (setq savehist-additional-variables '(mark-ring
                                        global-mark-ring
                                        search-ring
                                        regexp-search-ring
                                        extended-command-history))
  (setq savehist-autosave-interval 300))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a7b717" class="outline-3">
<h3 id="org6a7b717"><span class="section-number-3">4.6.</span> crux系统增强</h3>
<div class="outline-text-3" id="text-4-6">
<p>
<a href="https://github.com/bbatsov/crux">crux</a> 插件提供一系列的增强，如移动增强、删除增强等优化功能。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package crux
  :ensure t
  :bind (("C-a" . crux-move-beginning-of-line)
         ("C-x 4 t" . crux-transpose-windows)
         ("C-x K" . crux-kill-other-buffers)
         ("C-k" . crux-smart-kill-line)
         ("C-c r" . crux-rename-file-and-buffer)
         ("C-x DEL" . crux-kill-line-backwards))
  :config
  (crux-with-region-or-buffer indent-region)
  (crux-with-region-or-buffer untabify)
  (crux-with-region-or-point-to-eol kill-ring-save)
  (defalias 'rename-file-and-buffer #'crux-rename-file-and-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org25aede3" class="outline-3">
<h3 id="org25aede3"><span class="section-number-3">4.7.</span> restart-emacs</h3>
<div class="outline-text-3" id="text-4-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package restart-emacs
  :ensure t
  :bind
  (("C-c C-x r" . restart-emacs))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc3ebbb5" class="outline-3">
<h3 id="orgc3ebbb5"><span class="section-number-3">4.8.</span> 个人函数定义</h3>
<div class="outline-text-3" id="text-4-8">
<p>
以下是一些个人的函数定义，配置文件的其他部分会用到这些函数。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 将列表加入到列表
(defun add-list-to-list (dst src)
  "Similar to `add-to-list', but accepts a list as 2nd argument"
  (set dst
       (append (eval dst) src)))
</pre>
</div>
</div>
</div>
<div id="outline-container-org22a44a8" class="outline-3">
<h3 id="org22a44a8"><span class="section-number-3">4.9.</span> 设置代理</h3>
<div class="outline-text-3" id="text-4-9">
<div class="org-src-container">
<pre class="src src-rust">(defun set-proxy ()
  "设置代理"
  (interactive)
  (setq url-proxy-services
        '(("http" . "127.0.0.1:7890")
          ("https" . "127.0.0.1:7890")))
  (message "代理已设置为 127.0.0.1:7890"))

(set-proxy)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6d6ab3" class="outline-3">
<h3 id="orgc6d6ab3"><span class="section-number-3">4.10.</span> good-scroll</h3>
<div class="outline-text-3" id="text-4-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package good-scroll
  :ensure t
  :if window-system          ; 在图形化界面时才使用这个插件
  :init (good-scroll-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org324a93c" class="outline-3">
<h3 id="org324a93c"><span class="section-number-3">4.11.</span> init-base.el 文件尾</h3>
<div class="outline-text-3" id="text-4-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-base)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-base.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org83d7719" class="outline-2">
<h2 id="org83d7719"><span class="section-number-2">5.</span> init-edit.el</h2>
<div class="outline-text-2" id="text-5">
</div>

<div id="outline-container-org7312de2" class="outline-3">
<h3 id="org7312de2"><span class="section-number-3">5.1.</span> init-edit.el 文件头</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-edit.el --- Editing settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc44c047" class="outline-3">
<h3 id="orgc44c047"><span class="section-number-3">5.2.</span> Emacs备份设置</h3>
<div class="outline-text-3" id="text-5-2">
<p>
不使用Emacs的自动备份设置。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(setq make-backup-files nil)                                  ; 不自动备份
(setq auto-save-default nil)                                  ; 不使用Emacs自带的自动保存
</pre>
</div>
</div>
</div>

<div id="outline-container-org0bbbf4c" class="outline-3">
<h3 id="org0bbbf4c"><span class="section-number-3">5.3.</span> 解除一些不常用的快捷键</h3>
<div class="outline-text-3" id="text-5-3">
<p>
将一些不常用的快捷键解除，防止误操作。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 解除不常用的快捷键定义
(global-set-key (kbd "C-z") nil)
(global-set-key (kbd "s-q") nil)
(global-set-key (kbd "M-z") nil)
(global-set-key (kbd "M-m") nil)
(global-set-key (kbd "C-x C-z") nil)
(global-set-key [mouse-2] nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org789cb5f" class="outline-3">
<h3 id="org789cb5f"><span class="section-number-3">5.4.</span> delsel选择文本输入时直接替换</h3>
<div class="outline-text-3" id="text-5-4">
<p>
Emacs默认选择文本后直接输入，是不会直接删除所选择的文本进行替换的。通过内置的 <code>delsel</code> 插件来实现这个行为。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; Directly modify when selecting text
(use-package delsel
  :ensure nil
  :hook (after-init . delete-selection-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf9eb17" class="outline-3">
<h3 id="orgcf9eb17"><span class="section-number-3">5.5.</span> 自动重载设置</h3>
<div class="outline-text-3" id="text-5-5">
<p>
当我们的文件发生了改变后，我们希望Emacs里打开的永远是最新的文件，这个时候，我们需要对自动重载进行设置，让我们的Emacs在文件发生改变的时候自动重载文件。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package autorevert
  :ensure nil
  :hook (after-init . global-auto-revert-mode)
  :bind ("s-u" . revert-buffer)
  :custom
  (auto-revert-interval 10)
  (auto-revert-avoid-polling t)
  (auto-revert-verbose nil)
  (auto-revert-remote-files t)
  (auto-revert-check-vc-info t)
  (global-auto-revert-non-file-buffers t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org61b90dd" class="outline-3">
<h3 id="org61b90dd"><span class="section-number-3">5.6.</span> avy光标移动</h3>
<div class="outline-text-3" id="text-5-6">
<p>
<a href="https://github.com/abo-abo/avy">avy</a> 是一个光标移动插件，能快速将光标移动到屏幕上的任意字符，非常强大！
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy
  :ensure t
  :bind (("C-." . my/avy-goto-char-timer)
         ("C-。" . my/avy-goto-char-timer)
         :map isearch-mode-map
         ("C-." . avy-isearch))
  :config
  ;; Make `avy-goto-char-timer' support pinyin, refer to:
  ;; https://emacs-china.org/t/avy-avy-goto-char-timer/20900/2
  (defun my/avy-goto-char-timer (&amp;optional arg)
    "Make avy-goto-char-timer support pinyin"
    (interactive "P")
    (let ((avy-all-windows (if arg
                               (not avy-all-windows)
                             avy-all-windows)))
      (avy-with avy-goto-char-timer
        (setq avy--old-cands (avy--read-candidates
                              'pinyinlib-build-regexp-string))
        (avy-process avy--old-cands))))

  (defun avy-action-kill-whole-line (pt)
    "avy action: kill the whole line where avy selection is"
    (save-excursion
      (goto-char pt)
      (kill-whole-line))
    (select-window
     (cdr
      (ring-ref avy-ring 0)))
    t)

  (defun avy-action-copy-whole-line (pt)
    "avy action: copy the whole line where avy selection is"
    (save-excursion
      (goto-char pt)
      (cl-destructuring-bind (start . end)
          (bounds-of-thing-at-point 'line)
        (copy-region-as-kill start end)))
    (select-window
     (cdr
      (ring-ref avy-ring 0)))
    t)

  (defun avy-action-yank-whole-line (pt)
    "avy action: copy the line where avy selection is and paste to current point"
    (avy-action-copy-whole-line pt)
    (save-excursion (yank))
    t)

  (defun avy-action-teleport-whole-line (pt)
    "avy action: kill the line where avy selection is and paste to current point"
    (avy-action-kill-whole-line pt)
    (save-excursion (yank)) t)

  (defun avy-action-helpful (pt)
    "avy action: get helpful information at point"
    (save-excursion
      (goto-char pt)
      (helpful-at-point))
    ;; (select-window
    ;;  (cdr (ring-ref avy-ring 0)))
    t)

  (defun avy-action-mark-to-char (pt)
    "avy action: mark from current point to avy selection"
    (activate-mark)
    (goto-char pt))

  (defun avy-action-flyspell (pt)
    "avy action: flyspell the word where avy selection is"
    (save-excursion
      (goto-char pt)
      (when (require 'flyspell nil t)
        (flyspell-correct-wrapper))))

  (defun avy-action-define (pt)
    "avy action: define the word in dictionary where avy selection is"
    (save-excursion
      (goto-char pt)
      (fanyi-dwim2)))

  (defun avy-action-embark (pt)
    "avy action: embark where avy selection is"
    (unwind-protect
        (save-excursion
          (goto-char pt)
          (embark-act))
      (select-window
       (cdr (ring-ref avy-ring 0))))
    t)

  (defun avy-action-google (pt)
    "avy action: google the avy selection when it is a word or browse it when it is a link"
    (save-excursion
      (goto-char pt)
      (my/search-or-browse)))

  (setf (alist-get ?k avy-dispatch-alist) 'avy-action-kill-stay
        (alist-get ?K avy-dispatch-alist) 'avy-action-kill-whole-line
        (alist-get ?w avy-dispatch-alist) 'avy-action-copy
        (alist-get ?W avy-dispatch-alist) 'avy-action-copy-whole-line
        (alist-get ?y avy-dispatch-alist) 'avy-action-yank
        (alist-get ?Y avy-dispatch-alist) 'avy-action-yank-whole-line
        (alist-get ?t avy-dispatch-alist) 'avy-action-teleport
        (alist-get ?T avy-dispatch-alist) 'avy-action-teleport-whole-line
        (alist-get ?H avy-dispatch-alist) 'avy-action-helpful
        (alist-get ?  avy-dispatch-alist) 'avy-action-mark-to-char
        (alist-get ?\; avy-dispatch-alist) 'avy-action-flyspell
        (alist-get ?= avy-dispatch-alist) 'avy-action-define
        (alist-get ?o avy-dispatch-alist) 'avy-action-embark
        (alist-get ?G avy-dispatch-alist) 'avy-action-google
        )

  :custom
  ;; (avy-case-fold-search t)              ; default is t
  (avy-timeout-seconds 1.0)
  (avy-all-windows t)
  (avy-background t)
  (avy-keys '(?a ?s ?d ?f ?g ?h ?j ?l ?q ?e ?r ?u ?i ?p ?n))
  )

(ace-pinyin-global-mode +1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb944446" class="outline-3">
<h3 id="orgb944446"><span class="section-number-3">5.7.</span> multiple-cursors多光标编辑</h3>
<div class="outline-text-3" id="text-5-7">
<p>
<a href="https://github.com/magnars/multiple-cursors.el">multiple-cursors</a> 插件能让Emacs实现多光标编辑和移动。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package multiple-cursors
  :ensure t
  :bind-keymap ("C-c o" . multiple-cursors-map)
  :bind (("C-`"   . mc/mark-next-like-this)
         ("C-\\"  . mc/unmark-next-like-this)
         :map multiple-cursors-map
              ("SPC" . mc/edit-lines)
              ("&gt;"   . mc/mark-next-like-this)
              ("&lt;"   . mc/mark-previous-like-this)
              ("a"   . mc/mark-all-like-this)
              ("n"   . mc/mark-next-like-this-word)
              ("p"   . mc/mark-previous-like-this-word)
              ("r"   . set-rectangular-region-anchor)
              )
  :config
  (defvar multiple-cursors-map nil "keymap for `multiple-cursors")
  (setq multiple-cursors-map (make-sparse-keymap))
  (setq mc/list-file (concat user-emacs-directory "/etc/mc-lists.el"))
  (setq mc/always-run-for-all t)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ad596d" class="outline-3">
<h3 id="org6ad596d"><span class="section-number-3">5.8.</span> init-edit.el 文件尾</h3>
<div class="outline-text-3" id="text-5-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; (message "init-base configuration: %.2fs"
;;          (float-time (time-subtract (current-time) my/init-base-start-time)))

(provide 'init-edit)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-edit.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org691c8bc" class="outline-2">
<h2 id="org691c8bc"><span class="section-number-2">6.</span> init-org.el</h2>
<div class="outline-text-2" id="text-6">
</div>

<div id="outline-container-org7ac216b" class="outline-3">
<h3 id="org7ac216b"><span class="section-number-3">6.1.</span> init-org.el 文件头</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-org.el --- Org mode settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-org749ecb5" class="outline-3">
<h3 id="org749ecb5"><span class="section-number-3">6.2.</span> org-mode</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org
  :ensure nil
  :mode ("\\.org\\'" . org-mode)
  :hook ((org-mode . visual-line-mode)
		 (org-mode . my/org-prettify-symbols))
  :commands (org-find-exact-headline-in-buffer org-set-tags)
  :custom-face
  ;; 设置Org mode标题以及每级标题行的大小
  (org-document-title ((t (:height 1.75 :weight bold))))
  (org-level-1 ((t (:height 1.2 :weight bold))))
  (org-level-2 ((t (:height 1.15 :weight bold))))
  (org-level-3 ((t (:height 1.1 :weight bold))))
  (org-level-4 ((t (:height 1.05 :weight bold))))
  (org-level-5 ((t (:height 1.0 :weight bold))))
  (org-level-6 ((t (:height 1.0 :weight bold))))
  (org-level-7 ((t (:height 1.0 :weight bold))))
  (org-level-8 ((t (:height 1.0 :weight bold))))
  (org-level-9 ((t (:height 1.0 :weight bold))))
  ;; 设置代码块用上下边线包裹
  (org-block-begin-line ((t (:underline t :background unspecified))))
  (org-block-end-line ((t (:overline t :underline nil :background unspecified))))
  :config
  ;; ================================
  ;; 在org mode里美化字符串
  ;; ================================
  (defun my/org-prettify-symbols ()
	(setq prettify-symbols-alist
		  (mapcan (lambda (x) (list x (cons (upcase (car x)) (cdr x))))
				  '(
					("[ ]"              . 9744)         ; ☐
					("[X]"              . 9745)         ; ☑
					("[-]"              . 8863)         ; ⊟
					("#+begin_src"      . 9998)         ; ✎
					("#+end_src"        . 9633)         ; □
                    ("#+begin_ai"       . 9883)         ; ⚛
                    ("#+end_ai"         . 9998)         ; ✎
					("#+begin_example"  . 129083)       ; 🌛
					("#+end_example"    . 129081)       ; 🌙
					("#+results:"       . 9776)         ; ☰
					("#+attr_latex:"    . "🄛")
					("#+attr_html:"     . "🄗")
					("#+attr_org:"      . "🄞")
					("#+name:"          . "🄝")         ; 127261
					("#+caption:"       . "🄒")         ; 127250
					("#+date:"          . "📅")         ; 128197
					("#+author:"        . "💁")         ; 128100
					("#+setupfile:"     . 128221)       ; 📝
					("#+email:"         . 128231)       ; 📧
					("#+startup:"       . 10034)        ; ✲
					("#+options:"       . 9965)         ; ⛭
					("#+title:"         . 10162)        ; ➲
					("#+subtitle:"      . 11146)        ; ⮊
					("#+downloaded:"    . 8650)         ; ⇊
					("#+language:"      . 128441)       ; 🖹
					("#+begin_quote"    . 187)          ; »
					("#+end_quote"      . 171)          ; «
                    ("#+begin_results"  . 8943)         ; ⋯
                    ("#+end_results"    . 8943)         ; ⋯
					)))
    (setq prettify-symbols-unprettify-at-point t)
	(prettify-symbols-mode 1))

  ;; 提升latex预览的图片清晰度
  (plist-put org-format-latex-options :scale 1.8)

  ;; 设置标题行之间总是有空格；列表之间根据情况自动加空格
  (setq org-blank-before-new-entry '((heading . t)
									 (plain-list-item . auto)
									 ))

  (setq org-clock-sound "~/.emacs.d/ding.wav")

  ;; ======================================
  ;; 设置打开Org links的程序
  ;; ======================================
  (defun my-func/open-and-play-gif-image (file &amp;optional link)
	"Open and play GIF image `FILE' in Emacs buffer.

Optional for Org-mode file: `LINK'."
	(let ((gif-image (create-image file))
		  (tmp-buf (get-buffer-create "*Org-mode GIF image animation*")))
	  (switch-to-buffer tmp-buf)
	  (erase-buffer)
	  (insert-image gif-image)
	  (image-animate gif-image nil t)
	  (local-set-key (kbd "q") 'bury-buffer)
	  ))
  (setq org-file-apps '(("\\.png\\'"     . default)
                        (auto-mode       . emacs)
                        (directory       . emacs)
                        ("\\.mm\\'"      . default)
                        ("\\.x?html?\\'" . default)
                        ("\\.pdf\\'"     . emacs)
                        ("\\.md\\'"      . emacs)
                        ("\\.gif\\'"     . my-func/open-and-play-gif-image)
                        ("\\.xlsx\\'"    . default)
                        ("\\.svg\\'"     . default)
                        ("\\.pptx\\'"    . default)
                        ("\\.docx\\'"    . default)))

  :custom
  ;; 设置Org mode的目录
  (org-directory "~/org")
  ;; 设置笔记的默认存储位置
  (org-default-notes-file (expand-file-name "capture.org" org-directory))
  ;; 启用一些子模块
  (org-modules '(ol-bibtex ol-gnus ol-info ol-eww org-habit org-protocol))
  ;; 在按M-RET时，是否根据光标所在的位置分行，这里设置为是
  ;; (org-M-RET-may-split-line '((default . nil)))
  ;; 一些Org mode自带的美化设置
  ;; 标题行美化
  (org-fontify-whole-heading-line t)
  ;; 设置标题行折叠符号
  (org-ellipsis "⤵")
  ;; 在活动区域内的所有标题栏执行某些命令
  (org-loop-over-headlines-in-active-region t)
  ;; TODO标签美化
  (org-fontify-todo-headline t)
  ;; DONE标签美化
  (org-fontify-done-headline t)
  ;; 引用块美化
  (org-fontify-quote-and-verse-blocks t)
  ;; 隐藏宏标记
  (org-hide-macro-markers t)
  ;; 隐藏强调标签
  (org-hide-emphasis-markers t)
  ;; 高亮latex语法
  (org-highlight-latex-and-related '(native script entities))
  ;; 以UTF-8显示
  (org-pretty-entities t)
  ;; 是否隐藏标题栏的前置星号，这里我们通过org-modern来隐藏
  ;; (org-hide-leading-stars t)
  ;; 当启用缩进模式时自动隐藏前置星号
  (org-indent-mode-turns-on-hiding-stars t)
  ;; 自动启用缩进
  (org-startup-indented nil)
  ;; 根据标题栏自动缩进文本
  (org-adapt-indentation nil)
  ;; 自动显示图片
  (org-startup-with-inline-images t)
  ;; 默认以Overview的模式展示标题行
  (org-startup-folded 'overview)
  ;; 允许字母列表
  (org-list-allow-alphabetical t)
  ;; 列表的下一级设置
  (org-list-demote-modify-bullet '(
								   ("-"  . "+")
                                   ("+"  . "1.")
								   ("1." . "a.")
								   ))
  ;; 编辑时检查是否在折叠的不可见区域
  (org-fold-catch-invisible-edits 'smart)
  ;; 在当前位置插入新标题行还是在当前标题行后插入，这里设置为当前位置
  (org-insert-heading-respect-content nil)
  ;; 设置图片的最大宽度，如果有imagemagick支持将会改变图片实际宽度
  ;; 四种设置方法：(1080), 1080, t, nil
  (org-image-actual-width nil)
  ;; imenu的最大深度，默认为2
  (org-imenu-depth 4)
  ;; 回车要不要触发链接，这里设置不触发
  (org-return-follows-link nil)
  ;; 上标^下标_是否需要特殊字符包裹，这里设置需要用大括号包裹
  (org-use-sub-superscripts '{})
  ;; 复制粘贴标题行的时候删除id
  (org-clone-delete-id t)
  ;; 粘贴时调整标题行的级别
  (org-yank-adjusted-subtrees t)

  ;; TOOD的关键词设置，可以设置不同的组
  (org-todo-keywords '((sequence "TODO(t)" "HOLD(h!)" "WIP(i!)" "WAIT(w!)" "|" "DONE(d!)" "CANCELLED(c@/!)")
					   (sequence "REPORT(r)" "BUG(b)" "KNOWNCAUSE(k)" "|" "FIXED(f!)")))
  ;; TODO关键词的样式设置
  (org-todo-keyword-faces '(("TODO"       :foreground "#7c7c75" :weight bold)
							("HOLD"       :foreground "#feb24c" :weight bold)
							("WIP"        :foreground "#0098dd" :weight bold)
							("WAIT"       :foreground "#9f7efe" :weight bold)
							("DONE"       :foreground "#50a14f" :weight bold)
							("CANCELLED"  :foreground "#ff6480" :weight bold)
							("REPORT"     :foreground "magenta" :weight bold)
							("BUG"        :foreground "red"     :weight bold)
							("KNOWNCAUSE" :foreground "yellow"  :weight bold)
							("FIXED"      :foreground "green"   :weight bold)))
  ;; 当标题行状态变化时标签同步发生的变化
  ;; Moving a task to CANCELLED adds a CANCELLED tag
  ;; Moving a task to WAIT adds a WAIT tag
  ;; Moving a task to HOLD adds WAIT and HOLD tags
  ;; Moving a task to a done state removes WAIT and HOLD tags
  ;; Moving a task to TODO removes WAIT, CANCELLED, and HOLD tags
  ;; Moving a task to DONE removes WAIT, CANCELLED, and HOLD tags
  (org-todo-state-tags-triggers
   (quote (("CANCELLED" ("CANCELLED" . t))
		   ("WAIT" ("WAIT" . t))
		   ("HOLD" ("WAIT") ("HOLD" . t))
		   (done ("WAIT") ("HOLD"))
		   ("TODO" ("WAIT") ("CANCELLED") ("HOLD"))
		   ("DONE" ("WAIT") ("CANCELLED") ("HOLD")))))
  ;; 使用专家模式选择标题栏状态
  (org-use-fast-todo-selection 'expert)
  ;; 父子标题栏状态有依赖
  (org-enforce-todo-dependencies t)
  ;; 标题栏和任务复选框有依赖
  (org-enforce-todo-checkbox-dependencies t)
  ;; 优先级样式设置
  (org-priority-faces '((?A :foreground "red")
						(?B :foreground "orange")
						(?C :foreground "yellow")))
  ;; 标题行全局属性设置
  (org-global-properties '(("EFFORT_ALL" . "0:15 0:30 0:45 1:00 2:00 3:00 4:00 5:00 6:00 7:00 8:00")
						   ("APPT_WARNTIME_ALL" . "0 5 10 15 20 25 30 45 60")
						   ("RISK_ALL" . "Low Medium High")
						   ("STYLE_ALL" . "habit")))
  ;; Org columns的默认格式
  (org-columns-default-format "%25ITEM %TODO %SCHEDULED %DEADLINE %3PRIORITY %TAGS %CLOCKSUM %EFFORT{:}")
  ;; 当状态从DONE改成其他状态时，移除 CLOSED: [timestamp]
  (org-closed-keep-when-no-todo t)
  ;; DONE时加上时间戳
  (org-log-done 'time)
  ;; 重复执行时加上时间戳
  (org-log-repeat 'time)
  ;; Deadline修改时加上一条记录
  (org-log-redeadline 'note)
  ;; Schedule修改时加上一条记录
  (org-log-reschedule 'note)
  ;; 以抽屉的方式记录
  (org-log-into-drawer t)
  ;; 紧接着标题行或者计划/截止时间戳后加上记录抽屉
  (org-log-state-notes-insert-after-drawers nil)

  ;; refile使用缓存
  (org-refile-use-cache t)
  ;; refile的目的地，这里设置的是agenda文件的所有标题
  (org-refile-targets '((org-agenda-files . (:maxlevel . 9))))
  ;; 将文件名加入到路径
  (org-refile-use-outline-path 'file)
  ;; 是否按步骤refile
  (org-outline-path-complete-in-steps nil)
  ;; 允许创建新的标题行，但需要确认
  (org-refile-allow-creating-parent-nodes 'confirm)

  ;; 设置标签的默认位置，默认是第77列右对齐
  ;; (org-tags-column -77)
  ;; 自动对齐标签
  (org-auto-align-tags t)
  ;; 标签不继承
  (org-use-tag-inheritance nil)
  ;; 在日程视图的标签不继承
  (org-agenda-use-tag-inheritance nil)
  ;; 标签快速选择
  (org-use-fast-tag-selection t)
  ;; 标签选择不需要回车确认
  (org-fast-tag-selection-single-key t)
  ;; 定义了有序属性的标题行也加上 OREDERD 标签
  (org-track-ordered-property-with-tag t)
  ;; 始终存在的的标签
  (org-tag-persistent-alist '(("read"     . ?r)
							  ("mail"     . ?m)
							  ("emacs"    . ?e)
							  ("study"    . ?s)
							  ("work"     . ?w)))
  ;; 预定义好的标签
  (org-tag-alist '((:startgroup)
				   ("crypt"    . ?c)
				   ("linux"    . ?l)
				   ("apple"    . ?a)
				   ("noexport" . ?n)
				   ("ignore"   . ?i)
				   ("TOC"      . ?t)
				   (:endgroup)))

  ;; 归档设置
  (org-archive-location "%s_archive::datetree/")
  )

(global-set-key (kbd "C-c SPC") 'org-mark-ring-goto)

;; Org mode的附加包，有诸多附加功能
(use-package org-contrib
  :ensure t)
</pre>
</div>
</div>
</div>
<div id="outline-container-org6d2f243" class="outline-3">
<h3 id="org6d2f243"><span class="section-number-3">6.3.</span> Org-modern</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-modern
  :ensure t
  :hook (after-init . (lambda ()
                        (setq org-modern-hide-stars 'leading)
                        (global-org-modern-mode t)))
  :config
  ;; 标题行型号字符
  (setq org-modern-star ["◉" "○" "✸" "✳" "◈" "◇" "✿" "❀" "✜"])
  ;; 额外的行间距，0.1表示10%，1表示1px
  (setq-default line-spacing 0.1)
  ;; tag边框宽度，还可以设置为 `auto' 即自动计算
  (setq org-modern-label-border 1)
  ;; 设置表格竖线宽度，默认为3
  (setq org-modern-table-vertical 2)
  ;; 设置表格横线为0，默认为0.1
  (setq org-modern-table-horizontal 0)
  ;; 复选框美化
  (setq org-modern-checkbox
        '((?X . #("▢✓" 0 2 (composition ((2)))))
          (?- . #("▢–" 0 2 (composition ((2)))))
          (?\s . #("▢" 0 1 (composition ((1)))))))
  ;; 列表符号美化
  (setq org-modern-list
        '((?- . "•")
          (?+ . "◦")
          (?* . "▹")))
  ;; 代码块左边加上一条竖边线（需要Org mode顶头，如果启用了 `visual-fill-column-mode' 会很难看）
  (setq org-modern-block-fringe t)
  ;; 代码块类型美化，我们使用了 `prettify-symbols-mode'
  (setq org-modern-block-name nil)
  ;; #+关键字美化，我们使用了 `prettify-symbols-mode'
  (setq org-modern-keyword nil)
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd547c98" class="outline-3">
<h3 id="orgd547c98"><span class="section-number-3">6.4.</span> org-appear</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-emacs-lis">(use-package org-appear
  :ensure t
  :hook (org-mode . org-appear-mode)
  :config
  (setq org-appear-autolinks t)
  (setq org-appear-autosubmarkers t)
  (setq org-appear-autoentities t)
  (setq org-appear-autokeywords t)
  (setq org-appear-inside-latex t)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org2742824" class="outline-3">
<h3 id="org2742824"><span class="section-number-3">6.5.</span> org-auto-tangle</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-emacs-lis">(use-package org-auto-tangle
  :ensure t
  :hook (org-mode . org-auto-tangle-mode)
  :config
  (setq org-auto-tangle-default t)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org70d71c4" class="outline-3">
<h3 id="org70d71c4"><span class="section-number-3">6.6.</span> org-src</h3>
<div class="outline-text-3" id="text-6-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-src
  :ensure nil
  :hook (org-babel-after-execute . org-redisplay-inline-images)
  :bind (("s-l" . show-line-number-in-src-block)
         :map org-src-mode-map
         ("C-c C-c" . org-edit-src-exit))
  :init
  ;; 设置代码块的默认头参数
  (setq org-babel-default-header-args
        '(
          (:eval    . "never-export")     ; 导出时不执行代码块
          (:session . "none")
          (:results . "replace")          ; 执行结果替换
          (:exports . "both")             ; 导出代码和结果
          (:cache   . "no")
          (:noweb   . "no")
          (:hlines  . "no")
          (:wrap    . "results")          ; 结果通过#+begin_results包裹
          (:tangle  . "no")               ; 不写入文件
          ))
  :config
  ;; ==================================
  ;; 如果出现代码运行结果为乱码，可以参考：
  ;; https://github.com/nnicandro/emacs-jupyter/issues/366
  ;; ==================================
  (defun display-ansi-colors ()
    (ansi-color-apply-on-region (point-min) (point-max)))
  (add-hook 'org-babel-after-execute-hook #'display-ansi-colors)

  ;; ==============================================
  ;; 通过overlay在代码块里显示行号，s-l显示，任意键关闭
  ;; ==============================================
  (defvar number-line-overlays '()
    "List of overlays for line numbers.")

  (defun show-line-number-in-src-block ()
    (interactive)
    (save-excursion
      (let* ((src-block (org-element-context))
             (nlines (- (length
                         (s-split
                          "\n"
                          (org-element-property :value src-block)))
                        1)))
        (goto-char (org-element-property :begin src-block))
        (re-search-forward (regexp-quote (org-element-property :value src-block)))
        (goto-char (match-beginning 0))

        (cl-loop for i from 1 to nlines
                 do
                 (beginning-of-line)
                 (let (ov)
                   (setq ov (make-overlay (point) (point)))
                   (overlay-put ov 'before-string (format "%3s | " (number-to-string i)))
                   (add-to-list 'number-line-overlays ov))
                 (next-line))))

    ;; now read a char to clear them
    (read-key "Press a key to clear numbers.")
    (mapc 'delete-overlay number-line-overlays)
    (setq number-line-overlays '()))

  ;; =================================================
  ;; 执行结果后，如果结果所在的文件夹不存在将自动创建
  ;; =================================================
  (defun check-directory-exists-before-src-execution (orig-fun
                                                      &amp;optional arg
                                                      info
                                                      params)
    (when (and (assq ':file (cadr (cdr (org-babel-get-src-block-info))))
               (member (car (org-babel-get-src-block-info)) '("mermaid" "ditaa" "dot" "lilypond" "plantuml" "gnuplot" "d2")))
      (let ((foldername (file-name-directory (alist-get :file (nth 2 (org-babel-get-src-block-info))))))
        (if (not (file-exists-p foldername))
            (mkdir foldername)))))
  (advice-add 'org-babel-execute-src-block :before #'check-directory-exists-before-src-execution)

  ;; =================================================
  ;; 自动给结果的图片加上相关属性
  ;; =================================================
  (setq original-image-width-before-del "400") ; 设置图片的默认宽度为400
  (setq original-caption-before-del "")        ; 设置默认的图示文本为空

  (defun insert-attr-decls ()
    "insert string before babel execution results"
    (insert (concat "\n#+CAPTION:"
                    original-caption-before-del
                    "\n#+ATTR_ORG: :width "
                    original-image-width-before-del
                    "\n#+ATTR_LATEX: :width "
                    (if (&gt;= (/ (string-to-number original-image-width-before-del) 800.0) 1)
                        "1.0"
                      (number-to-string (/ (string-to-number original-image-width-before-del) 800.0)))
                    "\\linewidth :float nil"
                    "\n#+ATTR_HTML: :width "
                    original-image-width-before-del
                    )))

  (defun insert-attr-decls-at (s)
    "insert string right after specific string"
    (let ((case-fold-search t))
      (if (search-forward s nil t)
          (progn
            ;; (search-backward s nil t)
            (insert-attr-decls)))))

  (defun insert-attr-decls-at-results (orig-fun
                                       &amp;optional arg
                                       info
                                       param)
    "insert extra image attributes after babel execution"
    (interactive)
    (progn
      (when (member (car (org-babel-get-src-block-info)) '("mermaid" "ditaa" "dot" "lilypond" "plantuml" "gnuplot" "d2"))
        (setq original-image-width-before-del (number-to-string (if-let* ((babel-width (alist-get :width (nth 2 (org-babel-get-src-block-info))))) babel-width (string-to-number original-image-width-before-del))))
        (save-excursion
          ;; `#+begin_results' for :wrap results, `#+RESULTS:' for non :wrap results
          (insert-attr-decls-at "#+begin_results")))
      (org-redisplay-inline-images)))
  (advice-add 'org-babel-execute-src-block :after #'insert-attr-decls-at-results)

  ;; 再次执行时需要将旧的图片相关参数行删除，并从中头参数中获得宽度参数，参考
  ;; https://emacs.stackexchange.com/questions/57710/how-to-set-image-size-in-result-of-src-block-in-org-mode
  (defun get-attributes-from-src-block-result (&amp;rest args)
    "get information via last babel execution"
    (let ((location (org-babel-where-is-src-block-result))
          ;; 主要获取的是图示文字和宽度信息，下面这个正则就是为了捕获这两个信息
          (attr-regexp "[:blank:]*#\\+\\(ATTR_ORG: :width \\([0-9]\\{3\\}\\)\\|CAPTION:\\(.*\\)\\)"))
      (setq original-caption-before-del "") ; 重置为空
      (when location
        (save-excursion
          (goto-char location)
          (when (looking-at (concat org-babel-result-regexp ".*$"))
            (next-line 2)               ; 因为有个begin_result的抽屉，所以往下2行
            ;; 通过正则表达式来捕获需要的信息
            (while (looking-at attr-regexp)
              (when (match-string 2)
                (setq original-image-width-before-del (match-string 2)))
              (when (match-string 3)
                (setq original-caption-before-del (match-string 3)))
              (next-line)               ; 因为设置了:wrap，所以这里不需要删除这一行
              )
            )))))
  (advice-add 'org-babel-execute-src-block :before #'get-attributes-from-src-block-result)

  :custom
  ;; 代码块语法高亮
  (org-src-fontify-natively t)
  ;; 使用编程语言的TAB绑定设置
  (org-src-tab-acts-natively t)
  ;; 保留代码块前面的空格
  (org-src-preserve-indentation t)
  ;; 代码块编辑窗口的打开方式：当前窗口+代码块编辑窗口
  (org-src-window-setup 'reorganize-frame)
  ;; 执行前是否需要确认
  (org-confirm-babel-evaluate nil)
  ;; 代码块默认前置多少空格
  (org-edit-src-content-indentation 0)
  ;; 代码块的语言模式设置，设置之后才能正确语法高亮
  (org-src-lang-modes '(("C"            . c)
                        ("C++"          . c++)
                        ("bash"         . sh)
                        ("cpp"          . c++)
                        ("elisp"        . emacs-lisp)
                        ("python"       . python)
                        ("shell"        . sh)
                        ("mysql"        . sql)
                        ))
  ;; 在这个阶段，只需要加载默认支持的语言
  (org-babel-load-languages '((python          . t)
                              (awk             . t)
                              (C               . t)
                              (calc            . t)
                              (emacs-lisp      . t)
                              (eshell          . t)
                              (shell           . t)
                              (sql             . t)
                              (css             . t)
                              ))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org94435be" class="outline-3">
<h3 id="org94435be"><span class="section-number-3">6.7.</span> limit the babel result length</h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; limit the babel result length
(defvar org-babel-result-lines-limit 40)
(defvar org-babel-result-length-limit 6000)

(defun org-babel-insert-result@limit (orig-fn result &amp;rest args)
  (if (not (member (car (org-babel-get-src-block-info)) '("jupyter-python"))) ; not for jupyter-python etc.
    (if (and result (or org-babel-result-lines-limit org-babel-result-length-limit))
        (let (new-result plines plenght limit)
          (with-temp-buffer
            (insert result)
            (setq plines (if org-babel-result-lines-limit
                             (goto-line org-babel-result-lines-limit)
                           (point-max)))
            (setq plenght (if org-babel-result-length-limit
                              (min org-babel-result-length-limit (point-max))
                            (point-max)))
            (setq limit (min plines plenght))
            (setq new-result (concat (buffer-substring (point-min) limit)
                                     (if (&lt; limit (point-max)) "..."))))
          (apply orig-fn new-result args))
      (apply orig-fn result args))
    (apply orig-fn result args)))

(advice-add 'org-babel-insert-result :around #'org-babel-insert-result@limit)
</pre>
</div>
</div>
</div>

<div id="outline-container-org88c3c04" class="outline-3">
<h3 id="org88c3c04"><span class="section-number-3">6.8.</span> 导出为中文</h3>
<div class="outline-text-3" id="text-6-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 使用xelatex，配合当前org文件最开始的配置来正常输出中文
(setq org-latex-pdf-process
      '("xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"))

;; 图片默认宽度
(setq org-image-actual-width '(400))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a820b9" class="outline-3">
<h3 id="org2a820b9"><span class="section-number-3">6.9.</span> 显示数学公式</h3>
<div class="outline-text-3" id="text-6-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun my/latex-hook ()
  (interactive)
  (turn-on-cdlatex)
  (turn-on-reftex))

(use-package tex
  :ensure auctex
  :custom
  (TeX-parse-self t) ; 自动解析 tex 文件
  (TeX-PDF-mode t)
  (TeX-DVI-via-PDFTeX t)
  :config
  (setq-default TeX-master t) ; 默认询问主文件
  (add-hook 'LaTeX-mode-hook 'my/latex-hook)) ; 加载LaTeX模式钩子

(use-package cdlatex)

(use-package texfrag
  :ensure t
  :hook (org-mode . texfrag-mode)
  :config
  (setq texfrag-extensions '("pdf"))
  (setq texfrag-dpi 900))

(setq TeX-source-correlate-mode t) ;; 编译后开启正反向搜索
(setq TeX-source-correlate-method 'synctex) ;; 正反向搜索的执行方式
(setq TeX-source-correlate-start-server t) ;; 不再询问是否开启服务器以执行反向搜索 
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8561e1" class="outline-3">
<h3 id="orgf8561e1"><span class="section-number-3">6.10.</span> org-download实现粘贴复制图片到orgmode</h3>
<div class="outline-text-3" id="text-6-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-download
  :defer t ;; 延迟加载
  :bind
  (:map org-mode-map
   ("C-M-y" . org-download-clipboard)) ;; 绑定从剪贴版粘贴截图的快捷键
  :custom
  (org-download-heading-lvl 1) ;; 用一级标题给截图文件命名
  :config
  (setq-default org-download-image-dir "./img")) ;; 用同级 ./img 目录放置截图文件

(add-hook 'dired-mode-hook 'org-download-enable)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgbd5ba66" class="outline-3">
<h3 id="orgbd5ba66"><span class="section-number-3">6.11.</span> toc-org目录自动生成</h3>
<div class="outline-text-3" id="text-6-11">
<p>
<a href="https://github.com/snosov1/toc-org">toc-org</a> 插件可以在Org文件里自动生成目录，只需给一个标题行设置一个标签为 <code>toc</code> 或 <code>toc_2</code> 即可（后者只生成2层）。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package toc-org
  :ensure t
  :hook (org-mode . toc-org-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c5bcdc" class="outline-3">
<h3 id="org3c5bcdc"><span class="section-number-3">6.12.</span> ol新增链接类型</h3>
<div class="outline-text-3" id="text-6-12">
<p>
<a href="https://google.com/search?q=Org%20mode">google Org mode</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ol
  :ensure nil
  :defer t
  :custom
  (org-link-keep-stored-after-insertion t)
  (org-link-abbrev-alist '(("github"        . "https://github.com/")
                           ("gitlab"        . "https://gitlab.com/")
                           ("google"        . "https://google.com/search?q=")
                           ("baidu"         . "https://baidu.com/s?wd=")
                           ("rfc"           . "https://tools.ietf.org/html/")
                           ("wiki"          . "https://en.wikipedia.org/wiki/")
                           ("youtube"       . "https://youtube.com/watch?v=")
                           ("zhihu"         . "https://zhihu.com/question/"))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org343076d" class="outline-3">
<h3 id="org343076d"><span class="section-number-3">6.13.</span> org mode auto update date</h3>
<div class="outline-text-3" id="text-6-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun update-org-date ()
  "Update the DATE property to the current date."
  (interactive)
  (save-excursion
    (goto-char (point-min))
    (when (re-search-forward "^#\\+DATE:.*$" nil t)
      (replace-match (format-time-string "#+DATE: &lt;%Y-%m-%d %a&gt;" (current-time))))))
  
(defun my-org-mode-config ()
  "Custom configurations for Org Mode."
  (add-hook 'before-save-hook 'update-org-date nil t))
  
(add-hook 'org-mode-hook 'my-org-mode-config)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e46fa9" class="outline-3">
<h3 id="org2e46fa9"><span class="section-number-3">6.14.</span> init-org.el 文件尾</h3>
<div class="outline-text-3" id="text-6-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-org)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-org.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9bedd77" class="outline-2">
<h2 id="org9bedd77"><span class="section-number-2">7.</span> init-completion.el</h2>
<div class="outline-text-2" id="text-7">
<p>
Emacs的补全设置。
</p>
</div>

<div id="outline-container-org61e1cda" class="outline-3">
<h3 id="org61e1cda"><span class="section-number-3">7.1.</span> init-completion.el 文件头</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-completion.el --- Completion settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-org0046bf8" class="outline-3">
<h3 id="org0046bf8"><span class="section-number-3">7.2.</span> consult</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; Example configuration for Consult
(use-package consult
  ;; Replace bindings. Lazily loaded due by `use-package'.
  :bind (;; C-c bindings in `mode-specific-map'
         ("C-c M-x" . consult-mode-command)
         ("C-c h" . consult-history)
         ("C-c k" . consult-kmacro)
         ("C-c m" . consult-man)
         ("C-c i" . consult-info)
         ([remap Info-search] . consult-info)
         ;; C-x bindings in `ctl-x-map'
         ("C-x M-:" . consult-complex-command)     ;; orig. repeat-complex-command
         ("C-x b" . consult-buffer)                ;; orig. switch-to-buffer
         ("C-x 4 b" . consult-buffer-other-window) ;; orig. switch-to-buffer-other-window
         ("C-x 5 b" . consult-buffer-other-frame)  ;; orig. switch-to-buffer-other-frame
         ("C-x r b" . consult-bookmark)            ;; orig. bookmark-jump
         ("C-x p b" . consult-project-buffer)      ;; orig. project-switch-to-buffer
         ;; Custom M-# bindings for fast register access
         ("M-#" . consult-register-load)
         ("M-'" . consult-register-store)          ;; orig. abbrev-prefix-mark (unrelated)
         ("C-M-#" . consult-register)
         ;; Other custom bindings
         ("M-y" . consult-yank-pop)                ;; orig. yank-pop
         ;; M-g bindings in `goto-map'
         ("M-g e" . consult-compile-error)
         ("M-g f" . consult-flymake)               ;; Alternative: consult-flycheck
         ("M-g g" . consult-goto-line)             ;; orig. goto-line
         ("M-g M-g" . consult-goto-line)           ;; orig. goto-line
         ("M-g o" . consult-outline)               ;; Alternative: consult-org-heading
         ("M-g m" . consult-mark)
         ("M-g k" . consult-global-mark)
         ("M-g i" . consult-imenu)
         ("M-g I" . consult-imenu-multi)
         ;; M-s bindings in `search-map'
         ("M-s d" . consult-find)
         ("M-s D" . consult-locate)
         ("M-s g" . consult-grep)
         ("M-s G" . consult-git-grep)
         ("M-s r" . consult-ripgrep)
         ("M-s l" . consult-line)
         ("M-s L" . consult-line-multi)
         ("M-s k" . consult-keep-lines)
         ("M-s u" . consult-focus-lines)
         ;; Isearch integration
         ("M-s e" . consult-isearch-history)
         :map isearch-mode-map
         ("M-e" . consult-isearch-history)         ;; orig. isearch-edit-string
         ("M-s e" . consult-isearch-history)       ;; orig. isearch-edit-string
         ("M-s l" . consult-line)                  ;; needed by consult-line to detect isearch
         ("M-s L" . consult-line-multi)            ;; needed by consult-line to detect isearch
         ;; Minibuffer history
         :map minibuffer-local-map
         ("M-s" . consult-history)                 ;; orig. next-matching-history-element
         ("M-r" . consult-history))                ;; orig. previous-matching-history-element

  ;; Enable automatic preview at point in the *Completions* buffer. This is
  ;; relevant when you use the default completion UI.
  :hook (completion-list-mode . consult-preview-at-point-mode)

  ;; The :init configuration is always executed (Not lazy)
  :init

  ;; Optionally configure the register formatting. This improves the register
  ;; preview for `consult-register', `consult-register-load',
  ;; `consult-register-store' and the Emacs built-ins.
  (setq register-preview-delay 0.5
        register-preview-function #'consult-register-format)

  ;; Optionally tweak the register preview window.
  ;; This adds thin lines, sorting and hides the mode line of the window.
  (advice-add #'register-preview :override #'consult-register-window)

  ;; Use Consult to select xref locations with preview
  (setq xref-show-xrefs-function #'consult-xref
        xref-show-definitions-function #'consult-xref)

  ;; Configure other variables and modes in the :config section,
  ;; after lazily loading the package.
  :config

  ;; Optionally configure preview. The default value
  ;; is 'any, such that any key triggers the preview.
  ;; (setq consult-preview-key 'any)
  ;; (setq consult-preview-key "M-.")
  ;; (setq consult-preview-key '("S-&lt;down&gt;" "S-&lt;up&gt;"))
  ;; For some commands and buffer sources it is useful to configure the
  ;; :preview-key on a per-command basis using the `consult-customize' macro.
  (consult-customize
   consult-theme :preview-key '(:debounce 0.2 any)
   consult-ripgrep consult-git-grep consult-grep
   consult-bookmark consult-recent-file consult-xref
   consult--source-bookmark consult--source-file-register
   consult--source-recent-file consult--source-project-recent-file
   ;; :preview-key "M-."
   :preview-key '(:debounce 0.4 any))

  ;; Optionally configure the narrowing key.
  ;; Both &lt; and C-+ work reasonably well.
  (setq consult-narrow-key "&lt;") ;; "C-+"

  ;; Optionally make narrowing help available in the minibuffer.
  ;; You may want to use `embark-prefix-help-command' or which-key instead.
  ;; (define-key consult-narrow-map (vconcat consult-narrow-key "?") #'consult-narrow-help)

  ;; By default `consult-project-function' uses `project-root' from project.el.
  ;; Optionally configure a different project root function.
  ;;;; 1. project.el (the default)
  ;; (setq consult-project-function #'consult--default-project--function)
  ;;;; 2. vc.el (vc-root-dir)
  ;; (setq consult-project-function (lambda (_) (vc-root-dir)))
  ;;;; 3. locate-dominating-file
  ;; (setq consult-project-function (lambda (_) (locate-dominating-file "." ".git")))
  ;;;; 4. projectile.el (projectile-project-root)
  ;; (autoload 'projectile-project-root "projectile")
  ;; (setq consult-project-function (lambda (_) (projectile-project-root)))
  ;;;; 5. No project support
  ;; (setq consult-project-function nil)
)
</pre>
</div>
</div>
</div>
<div id="outline-container-orgdbf61ca" class="outline-3">
<h3 id="orgdbf61ca"><span class="section-number-3">7.3.</span> vertico</h3>
<div class="outline-text-3" id="text-7-3">
<p>
为M-x命令行提供补全的功能
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico
  :ensure t
  :hook (after-init . vertico-mode)
  :bind (:map minibuffer-local-map
              ("M-&lt;DEL&gt;" . my/minibuffer-backward-kill)
              :map vertico-map
              ("M-q" . vertico-quick-insert)) ; use C-g to exit
  :config
  (defun my/minibuffer-backward-kill (arg)
    "When minibuffer is completing a file name delete up to parent
folder, otherwise delete a word"
    (interactive "p")
    (if minibuffer-completing-file-name
        ;; Borrowed from https://github.com/raxod502/selectrum/issues/498#issuecomment-803283608
        (if (string-match-p "/." (minibuffer-contents))
            (zap-up-to-char (- arg) ?/)
          (delete-minibuffer-contents))
      (backward-kill-word arg)))

  ;; Do not allow the cursor in the minibuffer prompt
  (setq minibuffer-prompt-properties
        '(read-only t cursor-intangible t face minibuffer-prompt))
  (add-hook 'minibuffer-setup-hook #'cursor-intangible-mode)

  (setq vertico-cycle t)                ; cycle from last to first
  :custom
  (vertico-count 15)                    ; number of candidates to display, default is 10
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org2de9125" class="outline-3">
<h3 id="org2de9125"><span class="section-number-3">7.4.</span> orderless</h3>
<div class="outline-text-3" id="text-7-4">
<p>
<a href="https://github.com/oantolin/orderless">oderless</a> 插件提供一种无序的补全新姿势，将一个搜索的范式变成数个以空格分隔的部分，各部分之间没有顺序，你要做的就是根据记忆输入关键词、空格、关键词。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orderless
  :ensure t
  :custom
  (completion-styles '(orderless basic))
  (completion-category-overrides '((file (styles basic partial-completion)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc5f19e" class="outline-3">
<h3 id="orgbc5f19e"><span class="section-number-3">7.5.</span> marginalia</h3>
<div class="outline-text-3" id="text-7-5">
<p>
<a href="https://github.com/minad/marginalia">marginalia</a> 插件给迷你缓冲区的补全候选条目添加一些提示。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; minibuffer helpful annotations
(use-package marginalia
  :ensure t
  :hook (after-init . marginalia-mode)
  :custom
  (marginalia-annotators '(marginalia-annotators-heavy marginalia-annotators-light nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org828223e" class="outline-3">
<h3 id="org828223e"><span class="section-number-3">7.6.</span> corfu</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<a href="https://github.com/minad/corfu">corfu</a> 通过弹窗进行补全。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package corfu
  ;; Optional customizations
  :custom
  (corfu-cycle t)                ;; Enable cycling for `corfu-next/previous'
  ;; (corfu-auto t)                 ;; Enable auto completion
  ;; (corfu-separator ?\s)          ;; Orderless field separator
  ;; (corfu-quit-at-boundary nil)   ;; Never quit at completion boundary
  ;; (corfu-quit-no-match nil)      ;; Never quit, even if there is no match
  ;; (corfu-preview-current nil)    ;; Disable current candidate preview
  ;; (corfu-preselect 'prompt)      ;; Preselect the prompt
  ;; (corfu-on-exact-match nil)     ;; Configure handling of exact matches
  (corfu-scroll-margin 5)        ;; Use scroll margin

  ;; Enable Corfu only for certain modes.
  :hook ( (shell-mode . corfu-mode)
          (eshell-mode . corfu-mode))

  ;; Recommended: Enable Corfu globally.
  ;; This is recommended since Dabbrev can be used globally (M-/).
  ;; See also `corfu-exclude-modes'.
  :init
  (global-corfu-mode)
  :bind
  (:map corfu-map
        ("SPC" . corfu-insert-separator)
        )
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org99e7aa3" class="outline-3">
<h3 id="org99e7aa3"><span class="section-number-3">7.7.</span> cape</h3>
<div class="outline-text-3" id="text-7-7">
<p>
<a href="https://github.com/minad/cape">Cape</a> 提供了一系列开箱即用的补全后端，跟corfu联合使用。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cape
  ;; Bind dedicated completion commands
  ;; Alternative prefix keys: C-c p, M-p, M-+, ...
  :bind (("C-c p p" . completion-at-point) ;; capf
         ("C-c p t" . complete-tag)        ;; etags
         ("C-c p d" . cape-dabbrev)        ;; or dabbrev-completion
         ("C-c p h" . cape-history)
         ("C-c p f" . cape-file)
         ("C-c p k" . cape-keyword)
         ("C-c p s" . cape-symbol)
         ("C-c p a" . cape-abbrev)
         ("C-c p l" . cape-line)
         ("C-c p w" . cape-dict)
         ("C-c p \\" . cape-tex)
         ("C-c p _" . cape-tex)
         ("C-c p ^" . cape-tex)
         ("C-c p &amp;" . cape-sgml)
         ("C-c p r" . cape-rfc1345))
  :init
  ;; Add `completion-at-point-functions', used by `completion-at-point'.
  ;; NOTE: The order matters!
  ;; (add-to-list 'completion-at-point-functions #'cape-dabbrev)
  ;; (add-to-list 'completion-at-point-functions #'cape-file)
  ;; (add-to-list 'completion-at-point-functions #'cape-elisp-block)
  ;; (add-to-list 'completion-at-point-functions #'cape-history)
  ;;(add-to-list 'completion-at-point-functions #'cape-keyword)
  ;;(add-to-list 'completion-at-point-functions #'cape-tex)
  ;;(add-to-list 'completion-at-point-functions #'cape-sgml)
  ;;(add-to-list 'completion-at-point-functions #'cape-rfc1345)
  ;;(add-to-list 'completion-at-point-functions #'cape-abbrev)
  (add-to-list 'completion-at-point-functions #'cape-dict)
  (add-to-list 'completion-at-point-functions #'cape-symbol)
  ;;(add-to-list 'completion-at-point-functions #'cape-line)
)
</pre>
</div>
</div>
</div>

<div id="outline-container-org42ec777" class="outline-3">
<h3 id="org42ec777"><span class="section-number-3">7.8.</span> completion</h3>
<div class="outline-text-3" id="text-7-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfdcb8a" class="outline-3">
<h3 id="orgdfdcb8a"><span class="section-number-3">7.9.</span> lsp-mode</h3>
<div class="outline-text-3" id="text-7-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lsp-mode
  :init
  ;; set prefix for lsp-command-keymap (few alternatives - "C-l", "C-c l")
  (setq lsp-keymap-prefix "C-c l")
  :hook (;; replace XXX-mode with concrete major-mode(e. g. python-mode)
         (XXX-mode . lsp)
         ;; if you want which-key integration
         (lsp-mode . lsp-enable-which-key-integration))
  :commands lsp)

;; optionally
;; (use-package lsp-ui :commands lsp-ui-mode)
;; if you are helm user
;; (use-package helm-lsp :commands helm-lsp-workspace-symbol)
;; if you are ivy user
;; (use-package lsp-ivy :commands lsp-ivy-workspace-symbol)
;; (use-package lsp-treemacs :commands lsp-treemacs-errors-list)
</pre>
</div>
</div>
</div>

<div id="outline-container-org867c76b" class="outline-3">
<h3 id="org867c76b"><span class="section-number-3">7.10.</span> eglot</h3>
<div class="outline-text-3" id="text-7-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eglot)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge34daa2" class="outline-3">
<h3 id="orge34daa2"><span class="section-number-3">7.11.</span> yasnippet模板补全</h3>
<div class="outline-text-3" id="text-7-11">
<p>
<a href="https://github.com/joaotavora/yasnippet">yasnippet</a> 插件是一个非常强大的模板补全系统。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; yasnippet settings
(use-package yasnippet
  :ensure t
  :diminish yas-minor-mode
  :hook ((after-init . yas-reload-all)
         ((prog-mode LaTeX-mode org-mode) . yas-minor-mode))
  :config
  ;; Suppress warning for yasnippet code.
  (require 'warnings)
  (add-to-list 'warning-suppress-types '(yasnippet backquote-change))

  (setq yas-prompt-functions '(yas-x-prompt yas-dropdown-prompt))
  (defun smarter-yas-expand-next-field ()
    "Try to `yas-expand' then `yas-next-field' at current cursor position."
    (interactive)
    (let ((old-point (point))
          (old-tick (buffer-chars-modified-tick)))
      (yas-expand)
      (when (and (eq old-point (point))
                 (eq old-tick (buffer-chars-modified-tick)))
        (ignore-errors (yas-next-field))))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org00f73d0" class="outline-3">
<h3 id="org00f73d0"><span class="section-number-3">7.12.</span> all-the-icons-completion补全图标美化</h3>
<div class="outline-text-3" id="text-7-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package all-the-icons-completion
  :ensure t
  :hook ((after-init . all-the-icons-completion-mode)
         (marginalia-mode . all-the-icons-completion-marginalia-setup))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ff2979" class="outline-3">
<h3 id="org3ff2979"><span class="section-number-3">7.13.</span> smartparens</h3>
<div class="outline-text-3" id="text-7-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package smartparens
  :ensure t
  :config
  (progn
    (smartparens-global-mode t))
  )

(use-package smartparens-config
  :ensure smartparens
  :config
  (progn
    (show-smartparens-global-mode t)))

(add-hook 'prog-mode-hook 'turn-on-smartparens-strict-mode)
(add-hook 'markdown-mode-hook 'turn-on-smartparens-strict-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org5570d6d" class="outline-3">
<h3 id="org5570d6d"><span class="section-number-3">7.14.</span> paren高亮匹配的括号</h3>
<div class="outline-text-3" id="text-7-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package paren
  :ensure nil
  :hook (after-init . show-paren-mode)
  :custom
  (show-paren-when-point-inside-paren t)
  (show-paren-when-point-in-periphery t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0205921" class="outline-3">
<h3 id="org0205921"><span class="section-number-3">7.15.</span> rainbow-delimeters多彩括号</h3>
<div class="outline-text-3" id="text-7-15">
<p>
<a href="https://github.com/Fanael/rainbow-delimiters">rainbow-delimiters</a> 插件将多彩显示括号等分隔符。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-delimiters
  :ensure t
  :hook (prog-mode . rainbow-delimiters-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-org7601500" class="outline-3">
<h3 id="org7601500"><span class="section-number-3">7.16.</span> init-completion.el 文件尾</h3>
<div class="outline-text-3" id="text-7-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-completion)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-completion.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd2ca19c" class="outline-2">
<h2 id="orgd2ca19c"><span class="section-number-2">8.</span> init-dired.el</h2>
<div class="outline-text-2" id="text-8">
<p>
Emacs文件管理设置。
</p>
</div>

<div id="outline-container-org5951f20" class="outline-3">
<h3 id="org5951f20"><span class="section-number-3">8.1.</span> init-dired.el 文件头</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-dired.el --- Dired settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf698e73" class="outline-3">
<h3 id="orgf698e73"><span class="section-number-3">8.2.</span> diredfl多彩美化</h3>
<div class="outline-text-3" id="text-8-2">
<p>
默认的Dired只有两种颜色以区分文件和文件夹，我们可以使用 <a href="https://github.com/purcell/diredfl">diredfl</a> 插件让Dired变得更加多彩一些：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package diredfl
  :ensure t
  :hook (dired-mode . diredfl-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge68481b" class="outline-3">
<h3 id="orge68481b"><span class="section-number-3">8.3.</span> all-the-icons-dired图标美化</h3>
<div class="outline-text-3" id="text-8-3">
<p>
我们通过 <a href="https://github.com/jtbm37/all-the-icons-dired">all-the-icons-dired</a> 插件给Dired添加好看的图标。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package all-the-icons-dired
  :ensure t
  :hook (dired-mode . all-the-icons-dired-mode)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf220757" class="outline-3">
<h3 id="orgf220757"><span class="section-number-3">8.4.</span> dirvish文件管理</h3>
<div class="outline-text-3" id="text-8-4">
<p>
<a href="https://github.com/alexluigit/dirvish">dirvish</a> 是在Dired基础之上的文件管理增强插件。需要安装 <code>poppler</code> 来预览PDF；安装 <code>ffmpegthumbnailer</code> 来预览视频。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dirvish
  :ensure t
  :hook (dired-mode . dirvish-mode)
  :config
  (use-package all-the-icons-dired
    :ensure t
    :config
    (add-hook 'dired-mode-hook 'all-the-icons-dired-mode)))
;; (dirvish-override-dired-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcacc9cc" class="outline-3">
<h3 id="orgcacc9cc"><span class="section-number-3">8.5.</span> init-dired.el 文件尾</h3>
<div class="outline-text-3" id="text-8-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(provide 'init-dired)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-dired.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge0bd352" class="outline-2">
<h2 id="orge0bd352"><span class="section-number-2">9.</span> Init-shell.el</h2>
<div class="outline-text-2" id="text-9">
<p>
Emacs里的shell设置。
</p>
</div>

<div id="outline-container-orgbc7a20d" class="outline-3">
<h3 id="orgbc7a20d"><span class="section-number-3">9.1.</span> init-shell.el 文件头</h3>
<div class="outline-text-3" id="text-9-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-shell.el --- (E)shell settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orga5ab39a" class="outline-3">
<h3 id="orga5ab39a"><span class="section-number-3">9.2.</span> eshell 基本配置</h3>
<div class="outline-text-3" id="text-9-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell
  :ensure nil
  :functions eshell/alias
  :hook ((eshell-mode . (lambda ()
                          (term-mode-common-init)
                          ;; Remove cmd args word by word
                          (modify-syntax-entry ?- "w")
                          (visual-line-mode 1)
                          (setenv "PAGER" "cat")))
         )
  :config
  (defun term-mode-common-init ()
  "The common initialization for term."
  (setq-local scroll-margin 0)
  (setq-local truncate-lines t)
  )
  ;; 在Emacs里输入vi，直接在buffer里打开文件
  (defalias 'eshell/vi 'find-file)
  (defalias 'eshell/vim 'find-file)

  ;; 语法高亮显示
  (defun eshell/bat (file)
    "cat FILE with syntax highlight."
    (with-temp-buffer
      (insert-file-contents file)
      (let ((buffer-file-name file))
        (delay-mode-hooks
          (set-auto-mode)
          (font-lock-ensure)))
      (buffer-string)))
  (defalias 'eshell/cat 'eshell/bat)

  ;; 交互式进入目录
  (defun eshell/z ()
    "cd to directory with completion."
    (let ((dir (completing-read "Directory: " (ring-elements eshell-last-dir-ring) nil t)))
      (eshell/cd dir)))

  ;; 查找文件
  (defun eshell/f (filename &amp;optional dir)
    "Search for files matching FILENAME in either DIR or the
current directory."
    (let ((cmd (concat
                ;; using find
                (executable-find "find")
                " " (or dir ".")
                " -not -path '*/.git*'"            ; ignore .git directory
                " -and -not -path 'build'"         ; ignore cmake build directory
                " -and -not -path '*/eln-cache*'"  ; ignore eln cache
                " -and -type f -and -iname "
                "'*" filename "*'")))
      (eshell-command-result cmd)))

  :custom
  (eshell-banner-message
   '(format "%s %s\n"
            (propertize (format " %s " (string-trim (buffer-name)))
                        'face 'mode-line-highlight)
            (propertize (current-time-string)
                        'face 'font-lock-keyword-face)))
  (eshell-scroll-to-bottom-on-input 'all)
  (eshell-scroll-to-bottom-on-output 'all)
  (eshell-kill-on-exit t)
  (eshell-kill-processes-on-exit t)
  ;; Don't record command in history if starts with whitespace
  (eshell-input-filter 'eshell-input-filter-initial-space)
  (eshell-error-if-no-glob t)
  (eshell-glob-case-insensitive t)
  ;; set scripts
  (eshell-rc-script (locate-user-emacs-file "etc/eshell/profile"))
  (eshell-login-script (locate-user-emacs-file "etc/eshell/login"))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org931576b" class="outline-3">
<h3 id="org931576b"><span class="section-number-3">9.3.</span> eshell alias 设置</h3>
<div class="outline-text-3" id="text-9-3">
<div class="org-src-container">
<pre class="src src-text">alias ff find-file $1
alias fo find-file-other-window $1
alias d dired $1
alias ll ls -alh
alias l. ls -dh .*
alias up eshell-up $1
alias pk eshell-up-peek $1
alias less view-file $1
alias more view-file $1
</pre>
</div>
</div>
</div>

<div id="outline-container-org34e8ffd" class="outline-3">
<h3 id="org34e8ffd"><span class="section-number-3">9.4.</span> eshell 里的 C-d</h3>
<div class="outline-text-3" id="text-9-4">
<p>
让 <code>C-d</code> 更智能：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package em-rebind
  :ensure nil
  :commands eshell-delchar-or-maybe-eof)

(use-package esh-mode
  :ensure nil
  :bind (:map eshell-mode-map
              ("C-d" . eshell-delchar-or-maybe-eof)
              ("C-r" . consult-history)
              ("C-l" . eshell/clear))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6eb8b3" class="outline-3">
<h3 id="orgc6eb8b3"><span class="section-number-3">9.5.</span> Eshell 的命令历史</h3>
<div class="outline-text-3" id="text-9-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package em-hist
  :ensure nil
  :defer t
  :custom
  (eshell-history-size 1024)
  (eshell-hist-ignoredups t)
  (eshell-save-history-on-exit t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc85f77e" class="outline-3">
<h3 id="orgc85f77e"><span class="section-number-3">9.6.</span> 有些命令使用 term</h3>
<div class="outline-text-3" id="text-9-6">
<p>
有一些命令如 top，我们还是使用 term：
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">;; following commands will run on term instead
(use-package em-term
  :ensure nil
  :defer t
  :custom
  (eshell-visual-commands '("top" "htop" "less" "more"))
  (eshell-visual-subcommands '(("git" "help" "lg" "log" "diff" "show")))
  (eshell-visual-options '(("git" "--help" "--paginate")))
  (eshell-destroy-buffer-when-process-dies t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b83cb5" class="outline-3">
<h3 id="org7b83cb5"><span class="section-number-3">9.7.</span> eshell-git-prompt 命令行主题</h3>
<div class="outline-text-3" id="text-9-7">
<p>
<a href="https://github.com/xuchunyang/eshell-git-prompt">eshell-git-prompt</a> 插件提供了数个好看的 Eshell 命令行主题。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell-git-prompt
  :ensure t
  :after esh-mode
  :custom-face
  (eshell-git-prompt-multiline2-dir-face ((t (:foreground "#c09035" :bold t))))
  :config
  (eshell-git-prompt-use-theme 'powerline)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcd02a61" class="outline-3">
<h3 id="orgcd02a61"><span class="section-number-3">9.8.</span> eshell-syntax-highlighting 语法高亮</h3>
<div class="outline-text-3" id="text-9-8">
<p>
<a href="https://github.com/akreisher/eshell-syntax-highlighting">eshell-syntax-highlighting</a> 插件为Eshell提供语法高亮。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell-syntax-highlighting
  :after esh-mode
  :ensure t
  :hook (eshell-mode . eshell-syntax-highlighting-global-mode)
  :custom-face
  (eshell-syntax-highlighting-shell-command-face ((t (:foreground "#7cc77f" :bold t))))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org35b5856" class="outline-3">
<h3 id="org35b5856"><span class="section-number-3">9.9.</span> esh-autosuggest自动补全</h3>
<div class="outline-text-3" id="text-9-9">
<p>
<a href="https://github.com/dieggsy/esh-autosuggest">esh-autosuggest</a> 提供Fish类似的Eshell命令自动补全功能。类似的插件还有 <a href="https://github.com/emacsmirror/capf-autosuggest">capf-autosuggest</a>。
</p>

<blockquote>
<p>
使用 <code>C-f</code> 来补全整句，使用 <code>M-f</code> 来补全一个词。
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package esh-autosuggest
  :ensure t
  :hook (eshell-mode . esh-autosuggest-mode)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org94c2d3b" class="outline-3">
<h3 id="org94c2d3b"><span class="section-number-3">9.10.</span> eshell-up快速进入父级文件夹</h3>
<div class="outline-text-3" id="text-9-10">
<p>
<a href="https://github.com/peterwvj/eshell-up">eshell-up</a> 插件可以快速进入当前文件夹的任何一个父级文件夹。通过 <code>up</code> 命令（已经设置了alias）进入当前文件夹的任何一级父目录。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eshell-up
  :ensure t
  :commands (eshell-up eshell-up-peek)
  :config
  ;; to print the matching parent directory before changing to it
  (setq eshell-up-print-parent-dir t)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org5924556" class="outline-3">
<h3 id="org5924556"><span class="section-number-3">9.11.</span> eshell 快捷键</h3>
<div class="outline-text-3" id="text-9-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun my-start-eshell-mode ()
  "启动 eshell 模式并将其放置在上方的窗口中"
  (interactive)
  (split-window-below)
  (other-window 1)
  (eshell)
  (enlarge-window (- 15)))

(global-set-key (kbd "&lt;f9&gt;") 'my-start-eshell-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org4656b35" class="outline-3">
<h3 id="org4656b35"><span class="section-number-3">9.12.</span> shell</h3>
<div class="outline-text-3" id="text-9-12">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun my-start-shell-mode ()
  "启动 Shell 模式并将其放置在上方的窗口中"
  (interactive)
  (split-window-below)
  (other-window 1)
  (term "/bin/zsh")
  (enlarge-window (- 15)))

(global-set-key (kbd "&lt;f10&gt;") 'my-start-shell-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga42a7b8" class="outline-3">
<h3 id="orga42a7b8"><span class="section-number-3">9.13.</span> init-shell.el 文件尾</h3>
<div class="outline-text-3" id="text-9-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-shell)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-shell.el ends here
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org682629a" class="outline-2">
<h2 id="org682629a"><span class="section-number-2">10.</span> init-tools.el</h2>
<div class="outline-text-2" id="text-10">
</div>

<div id="outline-container-org0b26027" class="outline-3">
<h3 id="org0b26027"><span class="section-number-3">10.1.</span> init-tools.el 文件头</h3>
<div class="outline-text-3" id="text-10-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-tools.el --- Tools settings -*- lexical-binding: t -*-
;;; Commentary: Useful tools to make Emacs efficient!

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-org6ea8c1b" class="outline-3">
<h3 id="org6ea8c1b"><span class="section-number-3">10.2.</span> helpful帮助增强</h3>
<div class="outline-text-3" id="text-10-2">
<p>
<a href="https://github.com/Wilfred/helpful">helpful</a> 插件提供了帮助增强。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package helpful
  :ensure t
  :commands (helpful-callable helpful-variable helpful-command helpful-key helpful-mode)
  :bind (([remap describe-command] . helpful-command)
         ("C-h f" . helpful-callable)
         ("C-h v" . helpful-variable)
         ("C-h s" . helpful-symbol)
         ("C-h S" . describe-syntax)
         ("C-h m" . describe-mode)
         ("C-h F" . describe-face)
         ([remap describe-key] . helpful-key))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb135492" class="outline-3">
<h3 id="orgb135492"><span class="section-number-3">10.3.</span> which-key快捷键</h3>
<div class="outline-text-3" id="text-10-3">
<p>
<a href="https://github.com/justbur/emacs-which-key">which-key</a> 插件将提示快捷键。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package which-key
  :ensure t
  :hook (after-init . which-key-mode)
  :config
  (which-key-add-key-based-replacements
    "C-c !" "flycheck"
    "C-c @" "hideshow"
    "C-c i" "ispell"
    "C-c t" "hl-todo"
    "C-x a" "abbrev"
    "C-x n" "narrow"
    "C-x t" "tab")
  :custom
  (which-key-idle-delay 0.7)
  (which-key-add-column-padding 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf1a904" class="outline-3">
<h3 id="orgaf1a904"><span class="section-number-3">10.4.</span> pyvenv-auto</h3>
<div class="outline-text-3" id="text-10-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pyvenv-auto)
(setenv "WORKON_HOME" "/home/elon/anaconda3/envs/")
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd79e723" class="outline-3">
<h3 id="orgd79e723"><span class="section-number-3">10.5.</span> vc设置</h3>
<div class="outline-text-3" id="text-10-5">
<p>
Emacs自带的vc设置。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vc
  :ensure nil
  :custom
  ;; 打开链接文件时，不进行追问
  (vc-follow-symlinks t)
  (vc-allow-async-revert t)
  (vc-handled-backends '(Git)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6f87b3" class="outline-3">
<h3 id="orgf6f87b3"><span class="section-number-3">10.6.</span> magit版本管理</h3>
<div class="outline-text-3" id="text-10-6">
<p>
<a href="https://github.com/magit/magit">magit</a> 是Emacs里的另一个杀手级应用！可以直接在Emacs里进行基于git的版本管理。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit
  :ensure t
  :hook (git-commit-mode . flyspell-mode)
  :bind (("C-x g"   . magit-status)
         ("C-x M-g" . magit-dispatch)
         ("C-c M-g" . magit-file-dispatch))
  :custom
  (magit-diff-refine-hunk t)
  (magit-ediff-dwim-show-on-hunks t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7934282" class="outline-3">
<h3 id="org7934282"><span class="section-number-3">10.7.</span> diff-hl高亮显示修改的部分</h3>
<div class="outline-text-3" id="text-10-7">
<p>
<a href="https://github.com/dgutov/diff-hl">diff-hl</a> 插件可以在左侧高亮显示相对于远程仓库的修改部分。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package diff-hl
  :ensure t
  :hook ((dired-mode         . diff-hl-dired-mode-unless-remote)
         (magit-pre-refresh  . diff-hl-magit-pre-refresh)
         (magit-post-refresh . diff-hl-magit-post-refresh))
  :init
  (global-diff-hl-mode t)
  :config
  ;; When Emacs runs in terminal, show the indicators in margin instead.
  (unless (display-graphic-p)
    (diff-hl-margin-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga04833e" class="outline-3">
<h3 id="orga04833e"><span class="section-number-3">10.8.</span> magit-delta增强git diff</h3>
<div class="outline-text-3" id="text-10-8">
<p>
<a href="https://github.com/dandavison/magit-delta">magit-delta</a> 插件可以通过 <code>git-delta</code> 来更优化的方式显示diff内容（需要提前安装 <code>brew install git-delta</code> ）。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-delta
  :ensure t
  :hook (magit-mode . magit-delta-mode)
  :config
  (setq magit-delta-hide-plus-minus-markers nil)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org685ceda" class="outline-3">
<h3 id="org685ceda"><span class="section-number-3">10.9.</span> swiper(find-help)</h3>
<div class="outline-text-3" id="text-10-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package swiper
  :ensure t
  :bind (("C-s" . swiper)
         )
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf478be9" class="outline-3">
<h3 id="orgf478be9"><span class="section-number-3">10.10.</span> eaf</h3>
<div class="outline-text-3" id="text-10-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eaf
  :load-path "~/emacs-application-framework"
  :config
  (require 'eaf-browser)                ; 启用浏览器
  (require 'eaf-pdf-viewer)          ; 启用PDF阅读器
  (require 'eaf-video-player)
  (require 'eaf-terminal)
  (require 'eaf-file-manager)
  (require 'eaf-music-player)
  (require 'eaf-markdown-previewer)
  (require 'eaf-rss-reader)
  (require 'eaf-org-previewer)
  )

;;;LaTeX config
(add-to-list 'TeX-command-list '("XeLaTeX" "%`xelatex --synctex=1%(mode)%' %t" TeX-run-TeX nil t))
(add-to-list 'TeX-view-program-list '("eaf" eaf-pdf-synctex-forward-view))
(add-to-list 'TeX-view-program-selection '(output-pdf "eaf"))
</pre>
</div>
</div>
</div>
<div id="outline-container-orga0e0d09" class="outline-3">
<h3 id="orga0e0d09"><span class="section-number-3">10.11.</span> init-tools.el 文件尾</h3>
<div class="outline-text-3" id="text-10-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-tools)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-tools.el ends here
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdd70590" class="outline-2">
<h2 id="orgdd70590"><span class="section-number-2">11.</span> init-note.el</h2>
<div class="outline-text-2" id="text-11">
<p>
emacs 写作助手
</p>
</div>
<div id="outline-container-orgd55de26" class="outline-3">
<h3 id="orgd55de26"><span class="section-number-3">11.1.</span> init-note.el 文件头</h3>
<div class="outline-text-3" id="text-11-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-note.el --- Noting settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-org547cafd" class="outline-3">
<h3 id="org547cafd"><span class="section-number-3">11.2.</span> org-ai</h3>
<div class="outline-text-3" id="text-11-2">
<p>
<a href="https://github.com/rksm/org-ai">org-ai</a> 插件可以访问 ChatGPT 并成为 Emacs 的智能助手。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-ai
  :ensure t
  :commands (org-ai-mode
             org-ai-global-mode)
  :bind (
         ("C-c q" . org-ai-prompt)
         ("C-c x" . org-ai-on-region)
         )
  :hook (org-mode . org-ai-mode)
  :config
  (setq org-ai-default-chat-system-prompt "You are an Emacs helper, please reply me in Org-mode format")
  (org-ai-install-yasnippets)
  )

(load-file "~/.emacs.d/keys/chatai-key.el")
(require 'chatai-key)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd651111" class="outline-3">
<h3 id="orgd651111"><span class="section-number-3">11.3.</span> org-noter</h3>
<div class="outline-text-3" id="text-11-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-noter
  :ensure t
  :custom
  (org-noter-notes-search-path '("~/Documents/Notes")) ;; 默认笔记路径
  (org-noter-auto-save-last-location t) ;; 自动保存上次阅读位置
  (org-noter-highlight-selected-text t)
  (org-noter-max-short-selected-text-length 20) ;; 默认为 80
  (org-noter-default-heading-title "第 $p$ 页的笔记") ;; 默认短标题格式
  :bind
  (("C-c n n" . org-noter) ;; 与 org-roam 配合
   :map org-noter-doc-mode-map ;; 加入左手键位
   ("e" . org-noter-insert-note)
   ("M-e" . org-noter-insert-precise-note)))

(defun replace-and-translate ()
  "将 org-mode 中的 BEGIN_QUOTE 替换为 begin_ai，换行加入 [SYS]: 你是一个擅长英文翻译为中文的翻译专家，请将下面的英文句子翻译为中文."
  (interactive)
  (save-excursion
    (goto-char (point-min))
    (while (search-forward "BEGIN_QUOTE" nil t)
      (replace-match "begin_ai\n[SYS]: 你是一个擅长英文翻译为中文的翻译专家，请将下面的英文句子翻译为中文" nil t))
    (goto-char (point-min))
    (while (search-forward "END_QUOTE" nil t)
      (replace-match "end_ai" nil t)))
  (goto-char (point-min))
  (while (search-forward "\\[SYS\\]: " nil t)
    (replace-match "[SYS]: " nil t))
  (shell-command-on-region (point-min) (point-max) "trans -b -no-auto -s en -t zh" t t))

</pre>
</div>
</div>
</div>

<div id="outline-container-org57e4456" class="outline-3">
<h3 id="org57e4456"><span class="section-number-3">11.4.</span> org-roam</h3>
<div class="outline-text-3" id="text-11-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-roam
  :ensure t
  :custom
  (org-roam-directory (file-truename "~/org-roam"))
  :bind (("C-c n l" . org-roam-buffer-toggle)
         ("C-c n f" . org-roam-node-find)
         ("C-c n g" . org-roam-graph)
         ("C-c n i" . org-roam-node-insert)
         ("C-c n c" . org-roam-capture)
         ("C-c n u" . org-roam-ui-open)
         ;; Dailies
         ("C-c n j" . org-roam-dailies-capture-today))
  :bind-keymap
  ("C-c n d" . org-roam-dailies-map) ;; 日记菜单
  :config
  (require 'org-roam-dailies)
  ;;============= 新增内容 =================
  ;; 下面的 (setq my/ref-template ...) 可以放到 use-package 代码块之外
  (setq my/ref-template
        (concat "#+FILETAGS: reading research \n"
                "- tags :: %^{keywords} \n"
                "* %^{title}\n"
                ":PROPERTIES:\n"
                ":Custom_ID: %^{citekey}\n"
                ":URL: %^{url}\n"
                ":AUTHOR: %^{author-or-editor}\n"
                ":NOTER_DOCUMENT: ~/Nutstore Files/zotero-lib/%^{citekey}.pdf\n"
                ":NOTER_PAGE:\n"
                ":END:"))
  (add-to-list 'org-roam-capture-templates
               `("r" "Zotero 文献模板" plain ; 文献笔记模板
                 ,my/ref-template
                 :target
                 (file+head "ref/${citekey}.org" "#+title: ${title}\n")))

  (setq org-roam-capture-templates
        '(("n" "笔记" plain "%?"
           :if-new (file+head "%&lt;%Y%m%d%H%M%S&gt;-${slug}.org"
                              "#+title: ${title}\n#+date: %U\n")
           :unnarrowed t)))


  ;;============= 新增内容结束 =================
  ;; If you're using a vertical completion framework, you might want a more informative completion interface
  ;; (setq org-roam-node-display-template (concat "${title:*} " (propertize "${tags:10}" 'face 'org-tag)))
  (org-roam-db-autosync-mode)
  ;; If using org-roam-protocol
  ;;(require 'org-roam-protocol)
  )

(use-package org-roam-ui
  :ensure t
  :after org-roam
  :custom
  (org-roam-ui-sync-theme t)
  (org-roam-ui-follow-mode t)
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fb4f52" class="outline-3">
<h3 id="org6fb4f52"><span class="section-number-3">11.5.</span> rime</h3>
<div class="outline-text-3" id="text-11-5">
<p>
输入法设置
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rime
  :custom
  (default-input-method "rime")
  )

(global-set-key (kbd "C-\\") 'toggle-input-method)
</pre>
</div>
</div>
</div>

<div id="outline-container-org29d736e" class="outline-3">
<h3 id="org29d736e"><span class="section-number-3">11.6.</span> youdao dictionary</h3>
<div class="outline-text-3" id="text-11-6">
<p>
有道翻译
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package youdao-dictionary)
(global-set-key (kbd "C-c y") 'youdao-dictionary-search-at-point-tooltip)
(setq url-automatic-caching t)
(setq youdao-dictionary-search-history-file "~/.emacs.d/.youdao")
(setq youdao-dictionary-use-chinese-word-segmentation t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e525b3" class="outline-3">
<h3 id="org2e525b3"><span class="section-number-3">11.7.</span> plantuml绘图</h3>
<div class="outline-text-3" id="text-11-7">
<p>
<a href="https://plantuml.com/zh/">plantuml</a> 可以让我们在Org mode里通过纯文本画各种图，具体参考：<a href="https://plantuml.com/zh/emacs">PlantUML integration with Emacs</a>。
</p>

<p>
需要提前通过 <code>brew install plantuml</code> 安装 <code>plantuml</code> 。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package plantuml-mode
  :ensure t
  :mode ("\\.plantuml\\'" . plantuml-mode)
  :init
  ;; enable plantuml babel support
  (add-to-list 'org-src-lang-modes '("plantuml" . plantuml))
  (org-babel-do-load-languages 'org-babel-load-languages
                               (append org-babel-load-languages
                                       '((plantuml . t))))
  :config
  (setq org-plantuml-exec-mode 'plantuml)
  (setq org-plantuml-executable-path "plantuml")
  (setq plantuml-executable-path "plantuml")
  (setq plantuml-default-exec-mode 'executable)
  ;; set default babel header arguments
  (setq org-babel-default-header-args:plantuml
        '((:exports . "results")
          (:results . "file")
          ))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde999ef" class="outline-3">
<h3 id="orgde999ef"><span class="section-number-3">11.8.</span> gnuplot绘图</h3>
<div class="outline-text-3" id="text-11-8">
<p>
<a href="https://github.com/emacs-gnuplot/gnuplot">gnuplot</a> 插件可以让Emacs通过gnuplot绘图。
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gnuplot
  :ensure t
  :mode ("\\.gp$" . gnuplot-mode)
  :init
  (add-to-list 'org-src-lang-modes '("gnuplot" . gnuplot))
  (org-babel-do-load-languages 'org-babel-load-languages
                               (append org-babel-load-languages
                                       '((gnuplot . t))))
  :config
  ;; (add-to-list 'auto-mode-alist '("\\.gp$" . gnuplot-mode))
  (setq org-babel-default-header-args:gnuplot
      '((:exports . "results")
        (:results . "file")))
  )
</pre>
</div>
</div>
</div>
<div id="outline-container-org564bd19" class="outline-3">
<h3 id="org564bd19"><span class="section-number-3">11.9.</span> org-capture快速记录设置</h3>
<div class="outline-text-3" id="text-11-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package org-capture
  :ensure nil
  :bind ("\e\e c" . (lambda () (interactive) (org-capture)))
  :hook ((org-capture-mode . (lambda ()
                               (setq-local org-complete-tags-always-offer-all-agenda-tags t)))
         (org-capture-mode . delete-other-windows))
  :custom
  (org-capture-use-agenda-date nil)
  ;; define common template
  (org-capture-templates `(("t" "Tasks" entry (file+headline "tasks.org" "Reminders")
                            "* TODO %i%?"
                            :empty-lines-after 1
                            :prepend t)
                           ("n" "Notes" entry (file+headline "capture.org" "Notes")
                            "* %? %^g\n%i\n"
                            :empty-lines-after 1)
                           ;; For EWW
                           ("b" "Bookmarks" entry (file+headline "capture.org" "Bookmarks")
                            "* %:description\n\n%a%?"
                            :empty-lines 1
                            :immediate-finish t)
                           ("d" "Diary")
                           ("dt" "Today's TODO list" entry (file+olp+datetree "diary.org")
                            "* Today's TODO list [/]\n%T\n\n** TODO %?"
                            :empty-lines 1
                            :jump-to-captured t)
                           ("do" "Other stuff" entry (file+olp+datetree "diary.org")
                            "* %?\n%T\n\n%i"
                            :empty-lines 1
                            :jump-to-captured t)
                           ))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9732e0" class="outline-3">
<h3 id="orgf9732e0"><span class="section-number-3">11.10.</span> whisper</h3>
<div class="outline-text-3" id="text-11-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp"> (use-package whisper
  :load-path "/home/elon/.emacs.d/whisper.el"
  :bind ("M-s-r" . whisper-run)
  :config
  (setq whisper-model "base"
        whisper-language "en"
        whisper-translate nil)
  )

(use-package greader :ensure)
</pre>
</div>
</div>
</div>
<div id="outline-container-orge0bba10" class="outline-3">
<h3 id="orge0bba10"><span class="section-number-3">11.11.</span> init-note.el 文件尾</h3>
<div class="outline-text-3" id="text-11-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-note)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-dev.el ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf17473e" class="outline-2">
<h2 id="orgf17473e"><span class="section-number-2">12.</span> Init-language.el</h2>
<div class="outline-text-2" id="text-12">
<p>
Emacs里的language设置。
</p>
</div>


<div id="outline-container-orgc5a11fa" class="outline-3">
<h3 id="orgc5a11fa"><span class="section-number-3">12.1.</span> init-language.el 文件头</h3>
<div class="outline-text-3" id="text-12-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-language.el --- language settings -*- lexical-binding: t -*-
;;; Commentary:

;;; Code:

</pre>
</div>
</div>
</div>

<div id="outline-container-orga5b733e" class="outline-3">
<h3 id="orga5b733e"><span class="section-number-3">12.2.</span> Python-mode</h3>
<div class="outline-text-3" id="text-12-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package python
  :ensure t
  :mode ("\\.py\\'" . python-mode)
  :interpreter ("python" . python-mode)
  :config
  ;; 在保存时自动格式化代码
  (add-hook 'python-mode-hook
            (lambda ()
              (add-hook 'before-save-hook 'py-autopep8-before-save))))

(use-package pyvenv
  :ensure t
  :after python
  :config
  (add-hook 'python-mode-hook 'pyvenv-mode))

(use-package anaconda-mode
  :ensure t
  :hook (python-mode . anaconda-mode)
  :init
  (setq anaconda-mode-eldoc-as-single-line t))

(use-package company-anaconda
  :ensure t
  :after anaconda-mode
  :config
  (eval-after-load "company"
    '(add-to-list 'company-backends 'company-anaconda)))

(use-package elpy
  :ensure t
  :init
  (elpy-enable)
  :config
  (setq elpy-rpc-python-command "python3") ;; 设置 Python 解释器路径
  (setq python-shell-interpreter "python3")) ;; 设置 Python 解释器路径

(use-package flycheck
  :ensure t
  :init (global-flycheck-mode))

(use-package blacken
  :ensure t
  :hook (python-mode . blacken-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgba25a1e" class="outline-3">
<h3 id="orgba25a1e"><span class="section-number-3">12.3.</span> Rust-mode</h3>
<div class="outline-text-3" id="text-12-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; (use-package rust-mode)
;; (add-hook 'rust-mode-hook
;;           (lambda () (setq indent-tabs-mode nil)))
;; (setq rust-format-on-save t)

;; ;; (add-hook 'rust-mode-hook 'eglot-ensure)
;; (add-hook 'rust-mode-hook 'lsp-deferred)

;; Rust 开发配置
(use-package rust-mode
  :ensure t
  :hook (rust-mode . lsp-deferred)
  :config
  (setq rust-format-on-save t))

(add-hook 'rust-mode-hook
           (lambda () (prettify-symbols-mode)))

(use-package lsp-mode
  :ensure t
  :commands lsp
  :hook (rust-mode . lsp-deferred)
  :init
  (setq lsp-rust-server 'rust-analyzer))

(use-package company
  :ensure t
  :hook (prog-mode . company-mode)
  :config
  (setq company-tooltip-align-annotations t)
  (setq company-minimum-prefix-length 1)
  (setq company-idle-delay 0.0))

(use-package lsp-ui
  :ensure t
  :hook (lsp-mode . lsp-ui-mode)
  :config
  (setq lsp-ui-doc-enable nil)
  (setq lsp-ui-peek-enable t)
  (setq lsp-ui-sideline-enable nil))

(use-package lsp-treemacs
  :ensure t
  :commands lsp-treemacs-errors-list)

(use-package cargo
  :ensure t
  :hook (rust-mode . cargo-minor-mode))



(org-babel-do-load-languages 'org-babel-load-languages
                               (append org-babel-load-languages
                                       '((rust . t))))

;; 设置 Rust 语言的执行命令
(setq org-babel-rust-command "rustc")
</pre>
</div>
</div>
</div>
<div id="outline-container-org3dcb68b" class="outline-3">
<h3 id="org3dcb68b"><span class="section-number-3">12.4.</span> emacs-lisp-mode</h3>
<div class="outline-text-3" id="text-12-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package elisp-mode
  :ensure nil
  :after org
  :bind (:map emacs-lisp-mode-map
              ("C-c C-b" . eval-buffer)
              ("C-c C-c" . eval-to-comment)
              :map lisp-interaction-mode-map
              ("C-c C-c" . eval-to-comment)
              :map org-mode-map
              ("C-c C-;" . eval-to-comment)
              )
  :init
  ;; for emacs-lisp org babel
  (add-to-list 'org-babel-default-header-args:emacs-lisp
             '(:results . "value pp"))
  :config
  (defconst eval-as-comment-prefix " ⇒ ")
  (defun eval-to-comment (&amp;optional arg)
    (interactive "P")
    ;; (if (not (looking-back ";\\s*"))
    ;;     (call-interactively 'comment-dwim))
    (call-interactively 'comment-dwim)
    (progn
      (search-backward ";")
      (forward-char 1))
    (delete-region (point) (line-end-position))
    (save-excursion
      (let ((current-prefix-arg '(4)))
        (call-interactively 'eval-last-sexp)))
    (insert eval-as-comment-prefix)
    (end-of-line 1))
  )
</pre>
</div>
</div>
</div>

<div id="outline-container-org359052b" class="outline-3">
<h3 id="org359052b"><span class="section-number-3">12.5.</span> lua-moode</h3>
<div class="outline-text-3" id="text-12-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lua-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9cd1dea" class="outline-3">
<h3 id="org9cd1dea"><span class="section-number-3">12.6.</span> c-mode</h3>
<div class="outline-text-3" id="text-12-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;; 配置 C/C++ 开发环境
(use-package cc-mode
  :config
  ;; 启用语法检查
  (add-hook 'c-mode-hook 'flycheck-mode)
  (add-hook 'c++-mode-hook 'flycheck-mode)
  
  ;; 使用 company 补全
  (add-hook 'c-mode-hook 'company-mode)
  (add-hook 'c++-mode-hook 'company-mode)
  
  ;; 使用 clangd 作为 LSP 服务器
  (use-package lsp-mode
    :config
    (add-hook 'c-mode-hook 'lsp)
    (add-hook 'c++-mode-hook 'lsp))
  
  ;; 配置代码风格
  (setq c-default-style "linux"
        c-basic-offset 4
        tab-width 4
        indent-tabs-mode t)
  
  ;; 设置快捷键
  (define-key c-mode-base-map (kbd "RET") 'newline-and-indent))
</pre>
</div>
</div>
</div>
<div id="outline-container-org652f294" class="outline-3">
<h3 id="org652f294"><span class="section-number-3">12.7.</span> init-language.el 文件尾</h3>
<div class="outline-text-3" id="text-12-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-language)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-dev.el ends here
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org8ed4ffd" class="outline-2">
<h2 id="org8ed4ffd"><span class="section-number-2">13.</span> init-hugo.el</h2>
<div class="outline-text-2" id="text-13">
<p>
hugo设置
</p>
</div>

<div id="outline-container-org9e728d8" class="outline-3">
<h3 id="org9e728d8"><span class="section-number-3">13.1.</span> init-hugo.el文件头</h3>
<div class="outline-text-3" id="text-13-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">;;; init-hugo.el -- hugo settings -*-  lexical-binding: t -*-
;;; Commentary:

;;; Code:
</pre>
</div>
</div>
</div>


<div id="outline-container-org8b67b62" class="outline-3">
<h3 id="org8b67b62"><span class="section-number-3">13.2.</span> ox-hugo</h3>
<div class="outline-text-3" id="text-13-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ox-hugo
  :ensure t   ;Auto-install the package from Melpa
  :pin melpa  ;`package-archives' should already have ("melpa" . "https://melpa.org/packages/")
  :after ox)
</pre>
</div>
</div>
</div>

<div id="outline-container-org019ff5a" class="outline-3">
<h3 id="org019ff5a"><span class="section-number-3">13.3.</span> deploy-hugo</h3>
<div class="outline-text-3" id="text-13-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(defun execute-hugo-deploy-script (args)
  "执行 deploy.sh 脚本文件并将结果输出到 *Shell Output* 缓冲区"
  (interactive "sArguments: ")
  (let ((script-file "/home/elon/hugo_blog/blogsite/deploy.sh"))
    (if (file-exists-p script-file)
        (progn
          (message "Running deploy.sh script...")
          (shell-command (concat script-file " " args) "*Shell Output*"))
      (message "deploy.sh script file not found"))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga4143ba" class="outline-3">
<h3 id="orga4143ba"><span class="section-number-3">13.4.</span> init-hugo.el 文件尾</h3>
<div class="outline-text-3" id="text-13-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(provide 'init-hugo)
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;; init-dev.el ends here
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2023-07-09 Sun 00:00</p>
<p class="author">Author: Elon Li</p>
<p class="date">Created: 2023-07-09 Sun 13:01</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
